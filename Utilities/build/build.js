(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
"use strict";var PPEE=module.exports=function(){this._pp_events||(this._pp_events={})};PPEE.prototype.pre=function(t,p){t in this._pp_events||(this._pp_events[t]={pre:[],post:[]}),this._pp_events[t].pre.push(p)},PPEE.prototype.unPre=function(t,p){if(t in this._pp_events){var e=this._pp_events[t].pre;if(0!==e.length){var n=e.indexOf(p);-1!==n&&e.splice(n,1)}}},PPEE.prototype.unPost=function(t,p){if(t in this._pp_events){var e=this._pp_events[t].post;if(0!==e.length){var n=e.indexOf(p);-1!==n&&e.splice(n,1)}}},PPEE.prototype.post=function(t,p){t in this._pp_events||(this._pp_events[t]={pre:[],post:[]}),this._pp_events[t].post.push(p)},PPEE.prototype.run=function(t,p,e){if(!(t in this._pp_events))return e(p);t=this._pp_events[t];var n,s,i=t.pre,r=p;for(n=0,s=i.length;s>n;n++)r=i[n](r);var _=e(r),o=t.post;for(n=0,s=o.length;s>n;n++)_=o[n](r,_);return _};
},{}],2:[function(require,module,exports){
"use strict";var Armor=require("./index"),Element=require("../Element"),Unequipped=module.exports=function(e){Armor.call(this,e.game),this.setOwner(e),this.element=e.element};Unequipped.prototype=Object.create(Armor.prototype),Unequipped.prototype.constructor=Unequipped,Unequipped.prototype.modifyDamage=function(e){return Element.scaleDamage(this,e)};
},{"../Element":6,"./index":3}],3:[function(require,module,exports){
"use strict";var PPEE=require("../../../Abstract/pre-post-ee"),Equippable=require("../Equippable"),Armor=module.exports=function(e,t){Equippable.call(this,e),PPEE.call(this),this.element=t,this.game=e,this.modifyDamage=this.modifyDamage.bind(this),this.on("equip",function(e){e.pre("damage",this.modifyDamage)}),this.on("unequip",function(e){e.unPre("damage",this.modifyDamage)})};Armor.prototype=Object.create(Equippable.prototype);for(var i in PPEE)Armor.prototype[i]=PPEE.prototype[i];Armor.prototype.constructor=Armor,Armor.prototype.modifyDamage=function(){throw new Error("modifyDamage is Abstract and needs to be overridden")};
},{"../../../Abstract/pre-post-ee":1,"../Equippable":7}],4:[function(require,module,exports){
"use strict";var STATES=require("./Weapon/STATES.json"),UnEquippedWeapon=require("./Weapon/Unequipped"),Controllable=require("../Entity/Controllable"),Attacker=module.exports=function(t,e,a){Controllable.call(this,t,e),e.on("attack",this.attack.bind(this)),this.game=t,this.weapon=new UnEquippedWeapon(this),this.attackState=STATES.DORMANT,this.cancel=this.cancel.bind(this),this.idle=this.idle.bind(this),this.falter=this.falter.bind(this),a&&this.useWeapon(a)};Attacker.prototype=Object.create(Controllable.prototype),Attacker.prototype.constructor=Attacker,Attacker.prototype.attack=function(){switch(this.attackState){case STATES.ATTACK:return void this.cancel();case STATES.CANCEL:return void this.falter();case STATES.FALTER:return void this.falter();case STATES.IDLE:return void this.attack()}},Attacker.prototype.idle=function(){this.attackState=STATES.IDLE,this.weapon.idle()},Attacker.prototype.cancel=function(){return this.attackState===STATES.CANCEL?this.falter():(this.attackState=STATES.CANCEL,void this.weapon.cancel())},Attacker.prototype.falter=function(){this.attackState=STATES.FALTER,this.weapon.falter()},Attacker.prototype.useWeapon=function(t){this.weapon.setOwner(void 0),this.weapon.removeListener("impact",this.cancel),this.weapon.removeListener("finish",this.idle),this.weapon.removeListener("problem",this.falter),this.weapon=t,this.weapon.setOwner(this),this.attackState=STATES.FALTER,this.weapon.on("impact",this.cancel),this.weapon.on("finish",this.idle),this.weapon.on("problem",this.falter)};
},{"../Entity/Controllable":11,"./Weapon/STATES.json":8,"./Weapon/Unequipped":9}],5:[function(require,module,exports){
"use strict";var Entity=require("../Entity"),PPEE=require("../../Abstract/pre-post-ee"),UnEquippedArmor=require("./Armor/Unequipped"),Damageable=module.exports=function(e,t,a){Entity.call(this,e),PPEE.call(this),this.hp=t,this.armor=new UnEquippedArmor(this),this.applyDamage=this.applyDamage.bind(this),this.on("body",function(e){var t=this.getDamageableShape();this.damageableFixture=e.CreateFixture(t),this.damageableFixture.damageable=this,this.onContactStart(this.damageableFixture,this.applyDamage)}.bind(this)),this.doMovement=this.doMovement.bind(this),this.on("spawn",e.on.bind(e,"time",this.doMovement)),this.on("destroy",e.removeListener.bind(e,"time",this.doMovement)),a&&this.useArmor(a)};Damageable.prototype=Object.create(Entity.prototype);for(var i in PPEE.prototype)Damageable.prototype[i]=PPEE.prototype[i];Damageable.prototype.constructor=Damageable,Damageable.prototype.getDamageableShape=function(){throw new Error("getDamageableFixture is abstract and needs to be overridden")},Damageable.prototype.applyDamage=function(e,t,a){if(a.damager){var i=t.impulse.get_normalImpulses()[0],r=this.armor.impactThreshhold||1;if(!(r>=i)){var o=this.hp;this.run("damage",a.damager.getDamage(),function(e){return o-=e.value,e}),this.hp=o}}},Damageable.prototype.useArmor=function(e){this.armor.setOwner(void 0),this.armor=e,this.armor.setOwner(this)};
},{"../../Abstract/pre-post-ee":1,"../Entity":13,"./Armor/Unequipped":2}],6:[function(require,module,exports){
"use strict";module.exports.scaleDamage=function(e,t){if(!t.element)return.75;if(!e.element)return 1.25;var n=e.element,l=t.element,r=(n-l+3)%3,m=0===r?1:1===r?2:2===r?.5:0;t.value*=m};
},{}],7:[function(require,module,exports){
"use strict";var Entity=require("../Entity"),FixtureHelper=require("../../Helpers/box2d/Fixture"),Equippable=module.exports=function(t,e){Entity.call(this,t,e),this.owner=void 0,this.on("body",this.dungeonBody.bind(this))};Equippable.prototype=Object.create(Entity.prototype),Equippable.prototype.constructor=Equippable,Equippable.prototype.dungeonBody=function(t){if(!this.owner){var e=FixtureHelper.circle(3);e.set_isSensor(!0);var i=this,r=t.CreateFixture(e);i.onContactStart(r,function(t,e,r){if(!r.IsSensor()&&r.collisionEmitter){var o=r.collisionEmitter.emitter;o instanceof Equippable||o instanceof Entity&&Entity.emit("equippable",i)}})}},Equippable.prototype.setOwner=function(t){if(!this.owner&&!t)throw new Error("need to either: equip to an existant new Owner or Unequipped from current Owner");this.owner?this.emit("unequip",this.owner,this):this.body&&this.destroy(),t?this.emit("equip",t,this):this.owner.world&&this.spawn(this.owner.world,this.owner.body.GetWorldCenter()),this.owner=t};
},{"../../Helpers/box2d/Fixture":31,"../Entity":13}],8:[function(require,module,exports){
module.exports={
  "CANCEL": "canceling",
  "ATTACK": "attacking",
  "FALTER": "faltering",
  "IDLE": "idleing",
  "DORMANT": "sleeping"
}
},{}],9:[function(require,module,exports){
"use strict";var Weapon=require("./index"),Unequipped=module.exports=function(e){Weapon.call(this,e.game,5,5),this.element=e.element};Unequipped.prototype=Object.create(Weapon.prototype),Unequipped.prototype.constructor=Unequipped,Unequipped.prototype.doIdle=function(){var e=0;return function(){e=(e+1)%10}},Unequipped.prototype.doAttack=function(){var e=0;return function(){return e+=1,10===e?!0:void 0}},Unequipped.prototype.doCancel=function(){var e=0;return function(){return e+=1,10===e?!0:void 0}},Unequipped.prototype.doFalter=function(){var e=0;return function(){return e+=1,10===e?!0:void 0}};
},{"./index":10}],10:[function(require,module,exports){
"use strict";var Equippable=require("../Equippable"),FilterHelper=require("../../../Helpers/box2d/Filter"),STATES=require("./STATES.json"),Weapon=module.exports=function(t,e,i){Equippable.call(this,t),this.expense=i,this.damage=e,this.attackState=STATES.DORMANT,this.doTime=this.doTime.bind(this),this.doEquip=this.doEquip.bind(this),this.doUnequip=this.doUnequip.bind(this),this.handlerSpawning=this.handleSpawning.bind(this),this.destroy=this.destroy.bind(this),this.on("equip",this.doEquip),this.on("unequip",this.doUnequip),this.on("body",function(t){this.owner&&this.addContactStart(t,function(t,e,i){t.damager?this.emit("impact",i):this.falter()})}.bind(this))};Weapon.prototype=Object.create(Equippable.prototype),Weapon.prototype.constructor=Weapon,Weapon.prototype.doEquip=function(){this.game.on("time",this.doTime);var t=this.owner;t.world&&this.handleSpawning(),this.owner.on("spawn",this.handleSpawning),this.owner.on("destroy",this.destroy),this.idle()},Weapon.prototype.handleSpawning=function(){FilterHelper.newGroup([this.body,this.owner.body]),this.spawn(this.owner.world,this.owner.body.GetWorldCenter())},Weapon.prototype.doUnequip=function(t,e){this.game.removeListener("time",this.doTime),FilterHelper.resetCollidable(this.body),FilterHelper.removeFromGroup(this.body),e.removeListener("spawn",this.handleSpawning),e.removeListener("destroy",this.destroy),this.dormant()},Weapon.prototype.doTime=function(){if(this.current())switch(this.attackState){case STATES.FALTER:return void this.idle();case STATES.CANCEL:return void this.idle();case STATES.ATTACK:return void this.cancel()}},Weapon.prototype.attack=function(){FilterHelper.resetCollidable(this.body),this.current=this.doAttack()},Weapon.prototype.cancel=function(){FilterHelper.makeUncollidable(this.body),this.current=this.doCancel()},Weapon.prototype.idle=function(){this.emit("finish"),this.current=this.doIdle()},Weapon.prototype.dormant=function(){this.currentState=STATES.DORMANT},Weapon.prototype.falter=function(){this.emit("problem"),FilterHelper.makeUncollidable(this.body),this.current=this.doFalter()},Weapon.prototype.attachToOwner=function(){throw new Error("attachToOwner is abstract and needs to be implemented")},Weapon.STATES=STATES;
},{"../../../Helpers/box2d/Filter":30,"../Equippable":7,"./STATES.json":8}],11:[function(require,module,exports){
"use strict";var Entity=require("./index"),PPEE=require("../../Abstract/pre-post-ee"),Controllable=module.exports=function(t,o){this.controller||(Entity.call(this,t),PPEE.call(this),this.controller=o)};Controllable.prototype=Object.create(Entity.prototype);for(var i in PPEE)Controllable.prototype[i]=PPEE.prototype[i];Controllable.prototype.constructor=Controllable;
},{"../../Abstract/pre-post-ee":1,"./index":13}],12:[function(require,module,exports){
"use strict";var B2d=Module,Vec2=B2d.b2Vec2,Controllable=require("./Controllable"),impulse=new Vec2,Movable=module.exports=function(e,t){Controllable.call(this,e,t),t.on("change-direction",function(e){this.newDirection.set(e.get_x(),e.get_y())}.bind(this)),this.newDirection=new Vec2,this.oldDirection=new Vec2,this.doMovement=this.doMovement.bind(this),this.on("spawn",e.on.bind(e,"time",this.doMovement)),this.on("destroy",e.removeListener.bind(e,"time",this.doMovement))};Movable.prototype=Object.create(Controllable.prototype),Movable.prototype.constructor=Controllable,Movable.prototype.doMovement=function(){if(this.body){impulse.SetZero(),impulse.set(this.newDirection),impulse.Normalize();var e=this.body;this.run("movement",impulse,function(t){return e.ApplyLinearImpulse(t.clone().mul(e.GetMass()),e.GetWorldCenter()),t})}},Movable.prototype.useWeapon=function(e){this.weapon.setOwner(void 0),this.weapon=e,this.weapon.setOwner(this)};
},{"./Controllable":11}],13:[function(require,module,exports){
"use strict";var B2d=Module,Vec2=B2d.b2Vec2,BodyDef=B2d.b2BodyDef,ContactEmitter=require("../../General/Collision/ContactEmitter"),Entity=module.exports=function(t,i){if(ContactEmitter.call(this),!(this.game&&this.position&&this.rng)){if(!t)throw new Error("Need A Game Instance");this.position=i?i.clone():new Vec2,this.game=t,this.rng=t.rng}};Entity.prototype=Object.create(ContactEmitter.prototype),Entity.prototype.constructor=Entity,Entity.prototype.spawn=function(t,i){this.world=t,i&&this.position.set(i);var e=new BodyDef;e.set_type(B2d.b2_dynamicBody),e.set_position(this.position),e.set_fixedRotation(!1),this.emit("bodyDef",e);var o=this.body=t.CreateBody(e);o.entity=this,this.emit("body",o),this.emit("spawn",this)},Entity.prototype.destroy=function(t){t=this.world,this.position.set(this.body.GetWorldCenter()),this.removeContact(this.body),t.DestroyBody(this.body),delete this.body,this.emit("destroy",this)};
},{"../../General/Collision/ContactEmitter":24}],14:[function(require,module,exports){
"use strict";var EntityGen=module.exports=function(){this.entities=[]};EntityGen.prototype.addEntity=function(t){var i=this.entities.indexOf(t);if(i>-1)throw new Error("this entity already exists on this floor");this.entities.push(t),this.world&&t.spawn(this.world)},EntityGen.prototype.removeEntity=function(t){var i=this.entities.indexOf(t);if(-1===i)throw new Error("this entity doesn't exist on this floor");this.entities.splice(i,1),this.world&&t.destroy(this.world)};
},{}],15:[function(require,module,exports){
"use strict";var roomProto=require("./room-setup"),EntityGen=require("./entity-gen"),Floor=module.exports=function(o,t,r,e){this.tower=t,this.rng=t.game.rng,this.rooms=[],this.roles={},this.lastFloor=o,o&&(o.nextFloor=this),this.generateRooms(o),this.unusedRooms=this.rooms.map(function(o){return o}).sort(function(o,t){return t.depth-o.depth}),this.roles.Start=this.unusedRooms.pop(),this.applyRoles(r,e),EntityGen.call(this)};for(var name in roomProto)Floor.prototype[name]=roomProto[name];for(name in EntityGen.prototype)Floor.prototype[name]=EntityGen.prototype[name];Floor.prototype.constructor=Floor,Floor.prototype.applyRoles=function(o,t){for(var r=o.length;r--&&this.unusedRooms.length;)this.applyRole(o[r]);for(r=this.unusedRooms.length;r--;)t(this.unusedRooms.pop())},Floor.prototype.applyRole=function(o){var t=Math.floor(this.unusedRooms.length*Math.pow(this.rng(),2)),r=this.unusedRooms.splice(t,1)[0];r.setRole(o),this.roles[o.roleName]=r},Floor.prototype.spawn=function(o){this.world=o,this.rooms.forEach(function(t){t.spawn(o)}),this.entities.forEach(function(t){t.spawn(o)})},Floor.prototype.destroy=function(){var o=this.world;delete this.world,this.rooms.forEach(function(t){t.destroy(o)}),this.entities.forEach(function(t){t.destroy(o)})},Floor.prototype.undoRole=function(o){for(var t=o.roleName,r=this.rooms,e=0;e<r.length;e++)if(r[e].roleName===t)return r[e].undoRole()};
},{"./entity-gen":14,"./room-setup":16}],16:[function(require,module,exports){
"use strict";var DIMS=["x","y"],DIRS=[-1,1],Room=require("../Room"),prototype=module.exports={};prototype.generateRooms=function(t){this.generateStack=[],this.maxDepth=10,this.maxRooms=30,this.maxRoomLocation={x:10,y:10},this.scale=20,this.stackLength=0;var o=t?t.roles.End.location:{x:0,y:0};for(this.roles.start=this.createRoom(o),this.roles.start.name="start";this.stackLength;)this.stackLength--,this.generateStack.pop()()},prototype.createRoom=function(t){var o=new Room(t,this);return this.rooms.push(o),o.depth===this.maxDepth?o:(o.iterateAdjacents(function(t,e,i){if(!t){var n=e===DIMS[0]?DIMS[1]:DIMS[0],s={};s[e]=o.location[e],s[n]=o.location[n]+parseInt(i),this.maxRoomLocation[n]<s[n]||this.stackRoom(o.depth+1,s)}}.bind(this)),o)},prototype.stackRoom=function(t,o){if(this.rooms.length!==this.maxRooms){this.stackLength++;var e=Math.round(this.generateStack.length*this.rng());e===this.generateStack.length?this.generateStack.push(this.attemptRoom.bind(this,t,o)):0===e?this.generateStack.unshift(this.attemptRoom.bind(this,t,o)):this.generateStack.splice(e,0,this.attemptRoom.bind(this,t,o))}},prototype.attemptRoom=function(t,o){if(!this.hasRoomAt(o)){var e=this.maxRooms-this.rooms.length;if(e*=(this.maxRoomLocation.x-Math.abs(o.x)+(this.maxRoomLocation.y-Math.abs(o.y)))/2,e/=this.stackLength*this.stackLength+1,!(this.rng()>e)){for(var i=Number.POSITIVE_INFINITY,n=this.getDepths(o),s=[],a=0,r=n.length;r>a;a++){var h=n[a];if(s.indexOf(h)>-1)return;if(h-1===t)return;s.push(h),i=Math.min(i,h)}i>=t||this.createRoom(o)}}},prototype.hasRoomAt=function(t){return this.rooms.some(function(o){return o.location.x===t.x&&o.location.y===t.y})};var checkAdjacent;prototype.getDepths=function(t){return this.rooms.filter(function(o){var e=o.location;if(t.x===e.x){if(checkAdjacent(t,e,"y"))return!0}else if(t.y===e.y&&checkAdjacent(t,e,"x"))return!0;return!1}).map(function(t){return t.depth})},prototype.applyAdjacents=function(t){for(var o,e=this.rooms,i=e.length,n=t.location;i--;)if(e[i]!==t){var s=e[i].location;if(s.y===n.y&&s.x===n.x)throw new Error("We should never have two rooms with same x, y");n.x===s.x?(o=checkAdjacent(n,s,"y"),o&&t.setAdjacent("y",o,e[i])):n.y===s.y&&(o=checkAdjacent(n,s,"x"),o&&t.setAdjacent("x",o,e[i]))}},checkAdjacent=function(t,o,e){for(var i=DIRS.length;i--;)if(o[e]===t[e]+DIRS[i])return DIRS[i];return!1};
},{"../Room":21}],17:[function(require,module,exports){
"use strict";var Role=module.exports=function(e){if(!e.roleName)throw new Error("When creating a Role Class You need to provide a name");this.roleName=e.roleName,this.spawnRole=e.prototype.spawnRole.bind(this),this.destroyRole=e.prototype.destroyRole.bind(this),this.once("spawn",this.spawnRole),this.once("destroy",this.destroyRole),this.undoRole=e.prototype.undoRole.bind(this)};Role.prototype.undoRole=function(){delete this.roleName,this.removeListener("spawn",this.spawnRole),this.removeListener("destroy",this.destroyRole),delete this.spawnRole,delete this.destroyRole,delete this.undoRole},Role.prototype.spawnRole=function(){throw new Error("spawn is an abstract function and needs to be overridden")},Role.prototype.destroyRole=function(){throw new Error("destroy is an abstract function and needs to be overridden")};
},{}],18:[function(require,module,exports){
"use strict";var FixtureHelper=require("../../../Helpers/box2d/Fixture"),Role=require("../Role"),End=module.exports=function(){Role.call(this,End)};End.prototype=Object.create(Role.prototype),End.prototype.constructor=End,End.roleName="End",End.prototype.spawnRole=function(){var e=this,t=e.body,o=e.floor.scale,r=FixtureHelper.rect(o/4,o/4);r.set_isSensor(!0),r=t.CreateFixture(r),e.endSensor=r,e.onContactStart(r,function(t,o,n){var l=n.damageable;if(l&&l.isPlayer){var a=e.floor.tower;a.game.once("time",a.nextFloor.bind(a)),e.offContactStart(r)}})},End.prototype.destroyRole=function(){delete this.endSensor};
},{"../../../Helpers/box2d/Fixture":31,"../Role":17}],19:[function(require,module,exports){
"use strict";var DIMS=["x","y"],DIRS=["-1","1"],AdjacentGen=module.exports=function(t,e){this.id=Math.random(),this.location={x:t.x||0,y:t.y||0},this.depth=Math.POSITIVE_INFINITY,this.floor=e,this.adjacent={y:{"-1":void 0,1:void 0},x:{"-1":void 0,1:void 0},length:0},e.applyAdjacents(this),this.depth===Math.POSITIVE_INFINITY&&(this.depth=0)};AdjacentGen.prototype.setDepth=function(t){this.depth<=t||(this.depth=t,this.iterateAdjacents(function(e){e&&e.setDepth(t+1)}))},AdjacentGen.prototype.setAdjacent=function(t,e,h){if(this.adjacent[t][e]){if(h===this.adjacent[t][e])return;throw new Error("There are two different rooms at duplicate locations")}this.adjacent[t][e]=h,this.setDepth(h.depth+1),this.adjacent.length++,h.setAdjacent(t,-1*e,this)},AdjacentGen.prototype.remove=function(){this.iterateAdjacents(function(t,e,h){t&&t.removeAdjacent(e,-1*h)}),this.floor.rooms.splice(this.floor.rooms.indexOf(this),1)},AdjacentGen.prototype.removeAdjacent=function(t,e){var h=this.adjacent[t][e];if(delete this.adjacent[t][e],this.adjacent.length--,!(h.depth>this.depth)){var i=Number.POSITIVE_INFINITY;if(this.iterateAdjacents(function(t){t&&(i=Math.min(t.depth,i))}),i>this.depth)throw new Error("This room is unreachable");if(i<h.depth)throw new Error("This room depth should be the minimums depth + 1");i!==h.depth&&(this.depth=Number.POSITIVE_INFINITY,this.setDepth(i+1))}},AdjacentGen.prototype.iterateAdjacents=function(t){for(var e=this.adjacent,h=DIMS.length;h--;)for(var i=DIMS[h],n=DIRS.length;n--;){var o=DIRS[n];t(e[i][o],i,o)}};
},{}],20:[function(require,module,exports){
"use strict";var B2d=Module,Vec2=B2d.b2Vec2,BodyDef=B2d.b2BodyDef,FixtureHelper=require("../../Helpers/box2d/Fixture"),proto=module.exports;proto.getLocation=function(){return new Vec2(this.location.x,this.location.y).mul(2*this.floor.scale)},proto.spawn=function(t){var e=this.floor.scale;this.position=new Vec2(this.location.x,this.location.y),this.position.mul(2*e);var o=new BodyDef;o.set_position(this.position),o.set_type(B2d.b2_staticBody),this.body=t.CreateBody(o),this.body.SetUserData(this),this.iterateAdjacents(function(t,o,i){return i=parseInt(i),t?void this.createDoor(o,i,e):this.createWall(o,i,e)}.bind(this)),this.emit("spawn",this)},proto.destroy=function(t){this.removeContact(this.body),t.DestroyBody(this.body),this.emit("destroy",this)},proto.createWall=function(t,e,o){var i,r,s=new Vec2;"x"===t?(s.Set(e*(o-1),0),i=1,r=o):(s.Set(0,e*(o-1)),i=o,r=1),this.body.CreateFixture(FixtureHelper.rect(i,r,s,0))},proto.createDoor=function(t,e,o){var i,r,s=[],n=o/6;if("x"===t){var a=e*(o-1);s.push(new Vec2(a,n-o)),s.push(new Vec2(a,o-n)),i=1,r=o/3}else{var c=e*(o-1);s.push(new Vec2(n-o,c)),s.push(new Vec2(o-n,c)),i=o/3,r=1}var h=this.body;s.forEach(function(t){h.CreateFixture(FixtureHelper.rect(i,r,t,0))})};
},{"../../Helpers/box2d/Fixture":31}],21:[function(require,module,exports){
"use strict";var ContactEmitter=require("../../General/Collision/ContactEmitter"),AdjGen=require("./adjacent-generation"),Room=module.exports=function(o,t){if(!o)throw new Error("Rooms require a location");ContactEmitter.call(this),AdjGen.call(this,o,t)};Room.prototype=Object.create(ContactEmitter.prototype),Room.prototype.constructor=Room,Room.prototype.setRole=function(o){o.call(this)};for(var i in AdjGen.prototype)Room.prototype[i]=AdjGen.prototype[i];var box2d=require("./box2d");for(i in box2d)Room.prototype[i]=box2d[i];
},{"../../General/Collision/ContactEmitter":24,"./adjacent-generation":19,"./box2d":20}],22:[function(require,module,exports){
"use strict";var Floor=require("./Floor"),Tower=module.exports=function(o,r,t,e){this.game=o,this.world=o.world,t||(t=[]),t.some(function(o){return"End"===o.name})||(t.End=require("./Room/Roles/end"),t.push(t.End)),e||(e=function(){}),this.floors=this.createFloors(r,t,e)};Tower.prototype.createFloors=function(o,r,t){for(var e,n=[],s=0;o>s;s++){var i=new Floor(e,this,r,t);n.push(i),e=i}return e.undoRole(r.End),n},Tower.prototype.nextFloor=function(){this.currentFloor&&this.currentFloor.destroy(this.world),this.currentFloor=this.currentFloor.nextFloor,this.currentFloor.spawn(this.world)},Tower.prototype.setFloor=function(o){this.currentFloor&&this.currentFloor.destroy(this.world),this.currentFloor=this.floors[o],this.currentFloor.spawn(this.world)},Tower.prototype.getStart=function(){return this.currentFloor.roles.Start.getLocation()};
},{"./Floor":15,"./Room/Roles/end":18}],23:[function(require,module,exports){
"use strict";var Camera=module.exports=function(t,i,r,s){this.ctx=t,this.cur=i.cur,this.min={x:i.cur.x*i.min,y:i.cur.y*i.min},this.max={x:i.cur.x*i.max,y:i.cur.y*i.max},this.padding={x:i.cur.x*r,y:i.cur.y*r},this.lastPos={x:0,y:0},this.lastDim=this.dim={x:this.cur.x,y:this.cur.y},this.netScale={x:1,y:1},t.translate(-this.cur.x/2,-this.cur.y/2),t.scale(1,-1),this.following=[],this.targets=[],s&&s.on("zoom",function(t){this.padding.x+=this.padding.x*t/2,this.padding.y+=this.padding.y*t/2}.bind(this))};Camera.prototype.moveTo=function(t,i){this.ctx.translate(-t,-i),this.lastPos={x:t,y:i}},Camera.prototype.setSize=function(t,i){var r={x:this.cur.x/t,y:this.cur.y/i};this.ctx.scale(r.x,r.y),this.lastDim={x:t,y:i}},Camera.prototype.rotate=function(t){this.ctx.rotate(t)},Camera.prototype.step=function(t){var i=this.padding,r={max:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY},min:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY}};this.following.forEach(function(t){var s=t.GetWorldCenter();r.max.x=Math.max(r.max.x,s.get_x()+i.x),r.max.y=Math.max(r.max.y,s.get_y()+i.y),r.min.x=Math.min(r.min.x,s.get_x()-i.x),r.min.y=Math.min(r.min.y,s.get_y()-i.y)}),this.targets.forEach(function(i){var s,o=Math.min(1,t/i.time);i.desiredPosition?(i.currentPosition.x+=o*(i.desiredPosition.x-i.currentPosition.x),i.currentPosition.y+=o*(i.desiredPosition.y-i.currentPosition.y),s=i.currentPosition):s=this.currentPosition;var n;i.desiredDim?(i.currentDim.x+=o*(i.desiredDim.x-i.currentDim.x),i.currentDim.y+=o*(i.desiredDim.y-i.currentDim.y),n=i.currentDim):n=this.currentPosition,i.time=Math.max(0,i.time-t),r.max.x=Math.max(r.x,s.x+n.x/2),r.max.y=Math.max(r.y,s.y+n.y/2),r.min.x=Math.min(r.x,s.x-n.x/2),r.min.y=Math.min(r.y,s.y-n.y/2)});var s={x:Math.min(this.max.x,Math.max(this.min.x,r.max.x-r.min.x)),y:Math.min(this.max.y,Math.max(this.min.y,r.max.y-r.min.y))},o={x:(r.max.x+r.min.x)/2,y:(r.max.y+r.min.y)/2};(o.x!==this.lastPos.x||o.y!==this.lastPos.y||s.x!==this.lastDim.x||s.y!==this.lastDim.y)&&(this.ctx.setTransform(1,0,0,-1,this.cur.x/2,this.cur.y/2),this.setSize(s.x,s.y),this.moveTo(o.x,o.y))},Camera.prototype.follow=function(t){if(-1!==this.following.indexOf(t))throw new Error("already following this body");this.following.push(t)},Camera.prototype.unfollow=function(t){var i=this.following.indexOf(t);if(-1===i)throw new Error("Not following this body anymore");this.following.splice(i,1)},Camera.prototype.goToTarget=function(t,i,r){if(!r)throw new Error("cannot resolve a transform over zero time");this.targets.push({currentPosition:this.lastPos,currentDim:this.lastDim,desiredPosition:t,desiredDim:i,time:r})};
},{}],24:[function(require,module,exports){
"use strict";var EE=require("events").EventEmitter,Box2D=Module,b2Body=Box2D.b2Body,b2Fixture=Box2D.b2Fixture,ContactEmitter=module.exports=function(){this._events||EE.call(this)};ContactEmitter.prototype=Object.create(EE.prototype),ContactEmitter.prototype.constructor=ContactEmitter,ContactEmitter.prototype.onContactStart=function(t,o){this.appendContact(t,o,"-on")},ContactEmitter.prototype.onContactEnd=function(t,o){this.appendContact(t,o,"-off")},ContactEmitter.prototype.appendContact=function(t,o,e){if("function"!=typeof o)throw new Error("the second argument is expected to be a function");if(t instanceof b2Body){for(var i=t.GetFixtureList(),n=[];i.ptr;)n.push(this.appendContact(i,o,e)),i=i.GetNext();return n}if(!(t instanceof b2Fixture))throw new Error("Can only listen to a body or a fixture");return t.collisionEmitter||(t.collisionEmitter={uid:Date.now(),emitter:this}),this.on(t.collisionEmitter.uid+e,o)},ContactEmitter.prototype.offContactStart=function(t,o){this.removeContact(t,o,"-on")},ContactEmitter.prototype.offContactEnd=function(t,o){this.removeContact(t,o,"-off")},ContactEmitter.prototype.removeContact=function(t,o,e){if(t instanceof b2Body){for(var i=t.GetFixtureList(),n=[];i.ptr;)n.push(this.removeContact(i,o,e)),i=i.GetNext();return n}if(!(t instanceof b2Fixture))throw new Error("Can only listen to a body or a fixture");return t.collisionEmitter?e?o?this.removeListener(t.collisionEmitter.uid+e,o):this.removeAllListeners(t.collisionEmitter.uid+e):(this.removeAllListeners(t.collisionEmitter.uid+"on"),this.removeAllListeners(t.collisionEmitter.uid+"off")):void 0},ContactEmitter.attemptContact=function(t){var o=t.contact,e=t.impulse,i=t.isSensor,n=o.GetFixtureA(),r=o.GetFixtureB(),c=e||i?"-on":"-off";n.collisionEmitter&&n.collisionEmitter.emitter.emit(n.collisionEmitter.uid+c,n,t,r),r.collisionEmitter&&r.collisionEmitter.emitter.emit(r.collisionEmitter.uid+c,r,t,n)};
},{"events":36}],25:[function(require,module,exports){
"use strict";var ContactEmitter=require("./ContactEmitter"),Box2D=Module,listener=module.exports=new Box2D.JSContactListener,curContacts={};listener.BeginContact=function(t){var e=curContacts[t]={contact:Box2D.wrapPointer(t,Box2D.b2Contact)};e.isSensor=e.contact.GetFixtureA().IsSensor()||e.contact.GetFixtureB().IsSensor(),e.isSensor&&ContactEmitter.attemptContact(e)},listener.PreSolve=function(){},listener.PostSolve=function(t,e){var n=curContacts[t],o=n.impulse;n.impulse=e,o||ContactEmitter.attemptContact(n)},listener.EndContact=function(t,e){var n=curContacts[t];delete curContacts[t],delete n.impulse,ContactEmitter.attemptContact(n)};
},{"./ContactEmitter":24}],26:[function(require,module,exports){
"use strict";var EE=require("events").EventEmitter,Vec2=Module.b2Vec2,KeyBoard=module.exports=function(t){EE.call(this),this.isOn={A:!1,S:!1,D:!1,W:!1,P:!1,L:!1,38:!1,40:!1},this.vec2=new Vec2,t.addEventListener("keydown",function(t){var e=t.keyCode,i=String.fromCharCode(t.keyCode);if(!(i in this.isOn)){if(!(e in this.isOn))return;if(this.isOn[e])return;switch(this.isOn[e]=!0,e){case 38:return void this.zoomIn();case 40:return void this.zoomOut()}}if(!this.isOn[i])switch(this.isOn[i]=!0,i){case"A":return void this.move(-1,0);case"S":return void this.move(0,-1);case"D":return void this.move(1,0);case"W":return void this.move(0,1);case"P":return void this.run(!0);case"L":return void this.attack(!0)}}.bind(this)),t.addEventListener("keyup",function(t){var e=String.fromCharCode(t.keyCode);if(e in this.isOn)switch(this.isOn[e]=!1,e){case"A":return void this.move(1,0);case"S":return void this.move(0,1);case"D":return void this.move(-1,0);case"W":return void this.move(0,-1);case"P":return void this.run(!1);case"L":return void this.attack(!1)}}.bind(this))};KeyBoard.prototype=Object.create(EE.prototype),KeyBoard.prototype.constructor=KeyBoard,KeyBoard.prototype.move=function(t,e){this.vec2.add(t,e),this.emit("change-direction",this.vec2)},KeyBoard.prototype.run=function(t){this.emit("run",t)},KeyBoard.prototype.zoomIn=function(){this.emit("zoom",1)},KeyBoard.prototype.zoomOut=function(){this.emit("zoom",-1)},KeyBoard.prototype.attack=function(t){return t?this.emit("attack",t):void 0},KeyBoard.findKeyBoard=function(){return[document.body]};
},{"events":36}],27:[function(require,module,exports){
"use strict";var Box2D=Module,DebugDraw=Box2D.JSDraw,Vec2=Box2D.b2Vec2,proto={},tempV=new Vec2,tempV2=new Vec2;module.exports=function(t,o,e){var r=new DebugDraw;for(var a in proto)r[a]=proto[a];return r.width=o,r.height=e,r.context=t,r},proto.flush=function(){this.context._canvas&&this.context._canvas.frame()},proto.setColorFromDebugDrawCallback=function(t){var o=this.context,e=Box2D.wrapPointer(t,Box2D.b2Color),r=255*e.get_r()|0,a=255*e.get_g()|0,n=255*e.get_b()|0,i=r+","+a+","+n;o.fillStyle="rgba("+i+",0.5)",o.strokeStyle="rgb("+i+")"},proto.DrawSegment=function(t,o,e){var r=this.context;this.setColorFromDebugDrawCallback(e);var a=Box2D.wrapPointer(t,Box2D.b2Vec2),n=Box2D.wrapPointer(o,Box2D.b2Vec2);r.beginPath(),r.moveTo(a.get_x(),a.get_y()),r.lineTo(n.get_x(),n.get_y()),r.stroke()},proto.DrawPolygon=function(t,o,e){this.setColorFromDebugDrawCallback(e),this.polygon(t,o,!1)},proto.DrawSolidPolygon=function(t,o,e){this.setColorFromDebugDrawCallback(e),this.polygon(t,o,!0)},proto.polygon=function(t,o,e){var r=this.context;r.beginPath();for(var a=0;o>a;a++){var n=Box2D.wrapPointer(t+8*a,Box2D.b2Vec2);0===a?r.moveTo(n.get_x(),n.get_y()):r.lineTo(n.get_x(),n.get_y())}r.closePath(),e&&r.fill(),r.stroke()},proto.DrawCircle=function(t,o,e){this.setColorFromDebugDrawCallback(e);var r=Box2D.b2Vec2(0,0);this.circle(t,o,r,!1)},proto.DrawSolidCircle=function(t,o,e,r){this.setColorFromDebugDrawCallback(r),this.circle(t,o,e,!0)},proto.circle=function(t,o,e,r){var a=this.context,n=Box2D.wrapPointer(t,Box2D.b2Vec2),i=Box2D.wrapPointer(e,Box2D.b2Vec2);a.beginPath(),a.arc(n.get_x(),n.get_y(),o,0,2*Math.PI,!1),r&&a.fill(),a.stroke(),r&&(tempV.set(n).op_add(tempV2.set(i).mul(o)),a.beginPath(),a.moveTo(n.get_x(),n.get_y()),a.lineTo(tempV.get_x(),tempV.get_y()),a.stroke())},proto.DrawTransform=function(t){var o=this.context,e=Box2D.wrapPointer(t,Box2D.b2Transform),r=e.get_p(),a=e.get_q();o.save(),o.translate(r.get_x(),r.get_y()),o.rotate(a.GetAngle()),o.lineWidth*=2,this.axis(),o.restore()},proto.axis=function(){var t=this.context;t.strokeStyle="rgb(192,0,0)",t.beginPath(),t.moveTo(0,0),t.lineTo(1,0),t.stroke(),t.strokeStyle="rgb(0,192,0)",t.beginPath(),t.moveTo(0,0),t.lineTo(0,1),t.stroke()},proto.clear=function(){var t=this.context;t.save(),t.setTransform(1,0,0,1,0,0),t.clearRect(0,0,this.width,this.height),t.restore()};
},{}],28:[function(require,module,exports){
"use strict";var Vec2=Module.b2Vec2;Vec2.prototype.clone=function(){return new Vec2(this.get_x(),this.get_y())},Vec2.prototype.set=function(t,e){return void 0===e&&("object"==typeof t?(e=t.get_y(),t=t.get_x()):e=t),this.Set(t,e),this},Vec2.prototype.add=function(t,e){return void 0===e&&("object"==typeof t?(e=t.get_y(),t=t.get_x()):e=t),this.Set(this.get_x()+t,this.get_y()+e),this},Vec2.prototype.sub=function(t,e){return void 0===e&&("object"==typeof t?(e=t.get_y(),t=t.get_x()):e=t),this.Set(this.get_x()-t,this.get_y()-e),this},Vec2.prototype.mul=function(t,e){return void 0===e&&("object"==typeof t?(e=t.get_y(),t=t.get_x()):e=t),this.Set(this.get_x()*t,this.get_y()*e),this};
},{}],29:[function(require,module,exports){
require("./Vec2");
},{"./Vec2":28}],30:[function(require,module,exports){
"use strict";var Box2D=Module,b2Filter=Box2D.b2Filter,b2Body=Box2D.b2Body,b2Fixture=Box2D.b2Fixture,GROUP_COUNTER=1;module.exports.resetCollidable=function(e){if(e instanceof b2Fixture){if(!e.lastFilterValue&&!e.lastGroupValue)return;var t=e.GetFilterData();return t.set_maskBits(e.lastFilterValue),t.set_groupIndex(e.lastGroupValue),delete e.lastFilterValue,void delete e.lastGroupValue}if(e instanceof b2Body)for(var r=e.GetFixtureList();r;)this.resetCollidable(e),r=r.GetNext()},module.exports.makeUncollidable=function(e){if(e instanceof b2Fixture){var t=e.GetFilterData();return e.lastFilterValue=t.get_maskBits()||e.lastFilterValue,e.lastGroupValue=t.get_groupIndex()||e.lastGroupValue,t.set_maskBits(0),void t.set_groupIndex(0)}if(e instanceof b2Body)for(var r=e.GetFixtureList();r;)this.makeUncollidable(e),r=r.GetNext()},module.exports.newGroup=function(e,t){var r,o,i;for(o=0,i=e.length;i>o;o++)if(e[o].currentGroup){if(r&&r!==e[o].currentGroup)throw new Error("We have two bodies with different groups changing those groups may produce undesirable results");if(t&&e[o].currentGroup<1)throw new Error("When a body already has a collidable/uncollidable group, setting it to the opposite may produce undesireable results");r=e[o].currentGroup}for(r||(r=GROUP_COUNTER*(t?1:-1),GROUP_COUNTER*=2),o=0,i=e.length;i>o;o++)this.addToGroup(e[o],r)},module.exports.addToGroup=function(e,t){if(e instanceof b2Fixture){var r=e.GetFilterData();return void r.set_groupIndex(t)}if(e instanceof b2Body){for(var o=e.GetFixtureList();o;)this.addToGroup(e),o=o.GetNext();e.currentGroup=t}},module.exports.removeFromGroup=function(e,t){if(e instanceof b2Fixture){var r=e.GetFilterData();return void r.set_groupIndex(0)}if(e instanceof b2Body){for(var o=e.GetFixtureList();o;)this.removeFromGroup(e),o=o.GetNext();e.currentGroup=t}};
},{}],31:[function(require,module,exports){
"use strict";var B2d=Module,FixDef=B2d.b2FixtureDef,CircleShape=B2d.b2CircleShape,PolygonShape=B2d.b2PolygonShape;module.exports.circle=function(e,r){var t=new CircleShape;return t.set_m_radius(e),r&&t.set_m_p(r),this.createFixture(t)},module.exports.rect=function(){var e=new PolygonShape;return e.SetAsBox.apply(e,arguments),this.createFixture(e)},module.exports.polygon=function(){},module.exports.createFixture=function(e){var r=new FixDef;return r.set_shape(e),r.set_friction(.3),r};
},{}],32:[function(require,module,exports){
"use strict";var FixtureHelper=require("../Helpers/box2d/Fixture"),Player=require("./index"),PersonalBubble=module.exports=function(t,e){this.radius=e,this.player=t,this.activity=0,this.startImpact=this.startImpact.bind(this),this.endImpact=this.endImpact.bind(this),this.player.on("body",this.spawn.bind(this))};PersonalBubble.prototype.spawn=function(t){var e=FixtureHelper.circle(this.radius);e.set_isSensor(!0),e.personalBubble=this,this.fixture=t.CreateFixture(e),this.player.onContactStart(this.fixture,this.startImpact.bind(this)),this.player.onContactStart(this.fixture,this.endImpact.bind(this))},PersonalBubble.prototype.startImpact=function(t,e,i){return i.damager?void(this.player.adrenaline+=2):(i.personalBubble&&this.activity++,void(i.damageable&&i.damageable instanceof Player&&this.activity++))},PersonalBubble.prototype.endImpact=function(t,e,i){i.damager||(i.personalBubble&&this.activity--,i.damageable&&i.damageable instanceof Player&&this.activity--)};
},{"../Helpers/box2d/Fixture":31,"./index":33}],33:[function(require,module,exports){
"use strict";var PersonalBubble=require("./PersonalBubble"),Attacker=require("../Dungeon/Combat/Attacker"),Damageable=require("../Dungeon/Combat/Damageable"),Movable=require("../Dungeon/Entity/Moveable"),FixtureHelper=require("../Helpers/box2d/Fixture"),Player=module.exports=function(e,t,a){this.element=a.element,this.config=a,this.isPlayer=!0,Movable.call(this,e,t),Attacker.call(this,e,t),Damageable.call(this,e,a.hp),this.personalBubble=new PersonalBubble(this,a.personalBubbleRadius),this.adrenaline=0,this.energy=0,e.on("time",function(){this.adrenaline--,this.adrenaline+=this.personalBubble.activity,this.energy+=this.isRunning?-4:1}.bind(this)),this.controller.on("attack",function(){this.energy-=this.weapon.expense}.bind(this)),this.post("damage",function(e){this.adrenaline+=this.energy-Math.pow(e.value-this.energy,2)}.bind(this)),t.on("run",function(e){console.log(e),this.isRunning=e}.bind(this)),this.pre("movement",function(e){return e.mul(this.isRunning?a.runSpeed:a.walkSpeed).mul(Math.max(1,this.adrenaline)).sub(this.body.GetLinearVelocity())}.bind(this))};Player.prototype=Object.create(Movable.prototype);for(var name in Damageable.prototype)Player.prototype[name]=Damageable.prototype[name];for(name in Attacker.prototype)Player.prototype[name]=Attacker.prototype[name];Player.prototype.constructor=Player,Player.prototype.getDamageableShape=function(){return FixtureHelper.circle(this.config.damageableRadius)};
},{"../Dungeon/Combat/Attacker":4,"../Dungeon/Combat/Damageable":5,"../Dungeon/Entity/Moveable":12,"../Helpers/box2d/Fixture":31,"./PersonalBubble":32}],34:[function(require,module,exports){
"use strict";require("./Helpers/Override"),require("setimmediate");var EE=require("events").EventEmitter,Random=require("mersenne-twister"),Tower=require("./Dungeon/Tower"),Player=require("./Player"),Camera=require("./General/Camera"),contactListener=require("./General/Collision/ContactListener"),B2d=Module,Vec2=B2d.b2Vec2,World=B2d.b2World,Game=module.exports=function(e,t,r,o){EE.call(this);var a=new Random(e);this.rng=a.random.bind(a),this.world=new World(new Vec2),this.world.SetContactListener(contactListener),this.draw=t,this.camera=new Camera(t.context,{max:10,cur:o,min:.5},.1,r),this.world.SetDebugDraw(t),this.tower=new Tower(this,8),this.player=new Player(this,r,{hp:30,damageableRadius:3,personalBubbleRadius:10,runSpeed:10,walkSpeed:5})};Game.prototype=Object.create(EE.prototype),Game.prototype.constructor=Game,Game.prototype.loop=function(){var e=1/60;this.emit("time",e);var t=10;this.world.Step(e,t),this.render(e),setImmediate(this.loop.bind(this))},Game.prototype.render=function(e){this.draw.clear(),this.camera.step(e),this.world.DrawDebugData(),this.draw.flush()},Game.prototype.start=function(){console.log("starting"),this.tower.setFloor(0),this.player.spawn(this.world,this.tower.getStart()),this.camera.follow(this.player.body),console.log("spawned"),setImmediate(this.loop.bind(this))};
},{"./Dungeon/Tower":22,"./General/Camera":23,"./General/Collision/ContactListener":25,"./Helpers/Override":29,"./Player":33,"events":36,"mersenne-twister":38,"setimmediate":39}],35:[function(require,module,exports){
"use strict";var Game=require("./game"),Draw=require("./General/Draw"),Keyboard,keyboard,readyListener;readyListener=window.addEventListener.bind(window,"load"),Keyboard=require("./General/Controller/keyboard"),keyboard=new Keyboard(window);var e_shapeBit=1,e_jointBit=2,e_centerOfMassBit=16;readyListener(function(){var e,r,t,a=document.getElementsByTagName("canvas")[0];e=a.getContext("2d"),t=parseInt(window.getComputedStyle(a).width.substring(-2)),r=parseInt(window.getComputedStyle(a).height.substring(-2));var n=Draw(e,t,r),i=0;i|=e_shapeBit,i|=e_jointBit,i|=e_centerOfMassBit,n.SetFlags(i);var d=new Game(1234,n,keyboard,{x:t,y:r});d.start()});
},{"./General/Controller/keyboard":26,"./General/Draw":27,"./game":34}],36:[function(require,module,exports){
function EventEmitter(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function isFunction(e){return"function"==typeof e}function isNumber(e){return"number"==typeof e}function isObject(e){return"object"==typeof e&&null!==e}function isUndefined(e){return void 0===e}module.exports=EventEmitter,EventEmitter.EventEmitter=EventEmitter,EventEmitter.prototype._events=void 0,EventEmitter.prototype._maxListeners=void 0,EventEmitter.defaultMaxListeners=10,EventEmitter.prototype.setMaxListeners=function(e){if(!isNumber(e)||0>e||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},EventEmitter.prototype.emit=function(e){var t,n,s,i,r,o;if(this._events||(this._events={}),"error"===e&&(!this._events.error||isObject(this._events.error)&&!this._events.error.length)){if(t=arguments[1],t instanceof Error)throw t;throw TypeError('Uncaught, unspecified "error" event.')}if(n=this._events[e],isUndefined(n))return!1;if(isFunction(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:for(s=arguments.length,i=new Array(s-1),r=1;s>r;r++)i[r-1]=arguments[r];n.apply(this,i)}else if(isObject(n)){for(s=arguments.length,i=new Array(s-1),r=1;s>r;r++)i[r-1]=arguments[r];for(o=n.slice(),s=o.length,r=0;s>r;r++)o[r].apply(this,i)}return!0},EventEmitter.prototype.addListener=function(e,t){var n;if(!isFunction(t))throw TypeError("listener must be a function");if(this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,isFunction(t.listener)?t.listener:t),this._events[e]?isObject(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,isObject(this._events[e])&&!this._events[e].warned){var n;n=isUndefined(this._maxListeners)?EventEmitter.defaultMaxListeners:this._maxListeners,n&&n>0&&this._events[e].length>n&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace())}return this},EventEmitter.prototype.on=EventEmitter.prototype.addListener,EventEmitter.prototype.once=function(e,t){function n(){this.removeListener(e,n),s||(s=!0,t.apply(this,arguments))}if(!isFunction(t))throw TypeError("listener must be a function");var s=!1;return n.listener=t,this.on(e,n),this},EventEmitter.prototype.removeListener=function(e,t){var n,s,i,r;if(!isFunction(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(n=this._events[e],i=n.length,s=-1,n===t||isFunction(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(isObject(n)){for(r=i;r-->0;)if(n[r]===t||n[r].listener&&n[r].listener===t){s=r;break}if(0>s)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(s,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},EventEmitter.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[e],isFunction(n))this.removeListener(e,n);else for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},EventEmitter.prototype.listeners=function(e){var t;return t=this._events&&this._events[e]?isFunction(this._events[e])?[this._events[e]]:this._events[e].slice():[]},EventEmitter.listenerCount=function(e,t){var n;return n=e._events&&e._events[t]?isFunction(e._events[t])?1:e._events[t].length:0};
},{}],37:[function(require,module,exports){
function cleanUpNextTick(){draining=!1,currentQueue.length?queue=currentQueue.concat(queue):queueIndex=-1,queue.length&&drainQueue()}function drainQueue(){if(!draining){var e=setTimeout(cleanUpNextTick);draining=!0;for(var n=queue.length;n;){for(currentQueue=queue,queue=[];++queueIndex<n;)currentQueue&&currentQueue[queueIndex].run();queueIndex=-1,n=queue.length}currentQueue=null,draining=!1,clearTimeout(e)}}function Item(e,n){this.fun=e,this.array=n}function noop(){}var process=module.exports={},queue=[],draining=!1,currentQueue,queueIndex=-1;process.nextTick=function(e){var n=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)n[r-1]=arguments[r];queue.push(new Item(e,n)),1!==queue.length||draining||setTimeout(drainQueue,0)},Item.prototype.run=function(){this.fun.apply(null,this.array)},process.title="browser",process.browser=!0,process.env={},process.argv=[],process.version="",process.versions={},process.on=noop,process.addListener=noop,process.once=noop,process.off=noop,process.removeListener=noop,process.removeAllListeners=noop,process.emit=noop,process.binding=function(e){throw new Error("process.binding is not supported")},process.cwd=function(){return"/"},process.chdir=function(e){throw new Error("process.chdir is not supported")},process.umask=function(){return 0};
},{}],38:[function(require,module,exports){
var MersenneTwister=function(t){void 0==t&&(t=(new Date).getTime()),this.N=624,this.M=397,this.MATRIX_A=2567483615,this.UPPER_MASK=2147483648,this.LOWER_MASK=2147483647,this.mt=new Array(this.N),this.mti=this.N+1,this.init_seed(t)};MersenneTwister.prototype.init_seed=function(t){for(this.mt[0]=t>>>0,this.mti=1;this.mti<this.N;this.mti++){var t=this.mt[this.mti-1]^this.mt[this.mti-1]>>>30;this.mt[this.mti]=(1812433253*((4294901760&t)>>>16)<<16)+1812433253*(65535&t)+this.mti,this.mt[this.mti]>>>=0}},MersenneTwister.prototype.init_by_array=function(t,i){var s,h,n;for(this.init_seed(19650218),s=1,h=0,n=this.N>i?this.N:i;n;n--){var r=this.mt[s-1]^this.mt[s-1]>>>30;this.mt[s]=(this.mt[s]^(1664525*((4294901760&r)>>>16)<<16)+1664525*(65535&r))+t[h]+h,this.mt[s]>>>=0,s++,h++,s>=this.N&&(this.mt[0]=this.mt[this.N-1],s=1),h>=i&&(h=0)}for(n=this.N-1;n;n--){var r=this.mt[s-1]^this.mt[s-1]>>>30;this.mt[s]=(this.mt[s]^(1566083941*((4294901760&r)>>>16)<<16)+1566083941*(65535&r))-s,this.mt[s]>>>=0,s++,s>=this.N&&(this.mt[0]=this.mt[this.N-1],s=1)}this.mt[0]=2147483648},MersenneTwister.prototype.random_int=function(){var t,i=new Array(0,this.MATRIX_A);if(this.mti>=this.N){var s;for(this.mti==this.N+1&&this.init_seed(5489),s=0;s<this.N-this.M;s++)t=this.mt[s]&this.UPPER_MASK|this.mt[s+1]&this.LOWER_MASK,this.mt[s]=this.mt[s+this.M]^t>>>1^i[1&t];for(;s<this.N-1;s++)t=this.mt[s]&this.UPPER_MASK|this.mt[s+1]&this.LOWER_MASK,this.mt[s]=this.mt[s+(this.M-this.N)]^t>>>1^i[1&t];t=this.mt[this.N-1]&this.UPPER_MASK|this.mt[0]&this.LOWER_MASK,this.mt[this.N-1]=this.mt[this.M-1]^t>>>1^i[1&t],this.mti=0}return t=this.mt[this.mti++],t^=t>>>11,t^=t<<7&2636928640,t^=t<<15&4022730752,t^=t>>>18,t>>>0},MersenneTwister.prototype.random_int31=function(){return this.random_int()>>>1},MersenneTwister.prototype.random_incl=function(){return this.random_int()*(1/4294967295)},MersenneTwister.prototype.random=function(){return this.random_int()*(1/4294967296)},MersenneTwister.prototype.random_excl=function(){return(this.random_int()+.5)*(1/4294967296)},MersenneTwister.prototype.random_long=function(){var t=this.random_int()>>>5,i=this.random_int()>>>6;return(67108864*t+i)*(1/9007199254740992)},module.exports=MersenneTwister;
},{}],39:[function(require,module,exports){
(function (process){
!function(e,t){"use strict";function n(e){return d[l]=a.apply(t,e),l++}function a(e){var n=[].slice.call(arguments,1);return function(){"function"==typeof e?e.apply(t,n):new Function(""+e)()}}function r(e){if(p)setTimeout(a(r,e),0);else{var t=d[e];if(t){p=!0;try{t()}finally{s(e),p=!1}}}}function s(e){delete d[e]}function o(){g=function(){var e=n(arguments);return process.nextTick(a(r,e)),e}}function i(){if(e.postMessage&&!e.importScripts){var t=!0,n=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=n,t}}function c(){var t="setImmediate$"+Math.random()+"$",a=function(n){n.source===e&&"string"==typeof n.data&&0===n.data.indexOf(t)&&r(+n.data.slice(t.length))};e.addEventListener?e.addEventListener("message",a,!1):e.attachEvent("onmessage",a),g=function(){var a=n(arguments);return e.postMessage(t+a,"*"),a}}function u(){var e=new MessageChannel;e.port1.onmessage=function(e){var t=e.data;r(t)},g=function(){var t=n(arguments);return e.port2.postMessage(t),t}}function f(){var e=v.documentElement;g=function(){var t=n(arguments),a=v.createElement("script");return a.onreadystatechange=function(){r(t),a.onreadystatechange=null,e.removeChild(a),a=null},e.appendChild(a),t}}function m(){g=function(){var e=n(arguments);return setTimeout(a(r,e),0),e}}if(!e.setImmediate){var g,l=1,d={},p=!1,v=e.document,h=Object.getPrototypeOf&&Object.getPrototypeOf(e);h=h&&h.setTimeout?h:e,"[object process]"==={}.toString.call(e.process)?o():i()?c():e.MessageChannel?u():v&&"onreadystatechange"in v.createElement("script")?f():m(),h.setImmediate=g,h.clearImmediate=s}}(new Function("return this")());
}).call(this,require('_process'))
},{"_process":37}]},{},[35]);
