(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
"use strict";var PPEE=module.exports=function(){this._pp_events||(this._pp_events={})};PPEE.prototype.pre=function(t,p){t in this._pp_events||(this._pp_events[t]={pre:[],post:[]}),this._pp_events[t].pre.push(p)},PPEE.prototype.unPre=function(t,p){if(t in this._pp_events){var e=this._pp_events[t].pre;if(0!==e.length){var n=e.indexOf(p);-1!==n&&e.splice(n,1)}}},PPEE.prototype.unPost=function(t,p){if(t in this._pp_events){var e=this._pp_events[t].post;if(0!==e.length){var n=e.indexOf(p);-1!==n&&e.splice(n,1)}}},PPEE.prototype.post=function(t,p){t in this._pp_events||(this._pp_events[t]={pre:[],post:[]}),this._pp_events[t].post.push(p)},PPEE.prototype.run=function(t,p,e){if(!(t in this._pp_events))return e(p);t=this._pp_events[t];var n,s,i=t.pre,r=p;for(n=0,s=i.length;s>n;n++)r=i[n](r);var _=e(r),o=t.post;for(n=0,s=o.length;s>n;n++)_=o[n](r,_);return _};
},{}],2:[function(require,module,exports){
"use strict";var Armor=require("../../Dungeon/Combat/Armor"),Element=require("../../Dungeon/Combat/Element"),BasicMinus=module.exports=function(t){Armor.call(this,t),this.minus=1+Math.floor(Math.sqrt(1/t.rng())),this.element=1+Math.floor(3*t.rng())};BasicMinus.prototype=Object.create(Armor.prototype),BasicMinus.prototype.constructor=BasicMinus,BasicMinus.prototype.modifyDamage=function(t){return Math.max(0,Element.scaleDamage(this,t)-this.minus)};
},{"../../Dungeon/Combat/Armor":15,"../../Dungeon/Combat/Element":18}],3:[function(require,module,exports){
"use strict";var Damageable=require("../../Dungeon/Combat/Damageable"),Movable=require("../../Dungeon/Entity/Moveable"),FixtureHelper=require("../../Helpers/box2d/Fixture"),EarRangeAI=require("../../Dungeon/Combat/AI/target-finders/ear-range"),MoveToTarget=require("../../Dungeon/Combat/AI/target-processors/move-to-target"),DirectMovement=require("../../General/Movement/direct-control"),EE=require("events").EventEmitter,defaultConfig,ExampleMinion=module.exports=function(e,t){var a=new EE;t=t||defaultConfig,this.element=t.element,this.config=t,this.team=Number.NEGATIVE_INFINITY,this.isExampleMinion=!0,this.controller=a,Movable.call(this,e,a),Damageable.call(this,e,t.hp),EarRangeAI(this);var o=MoveToTarget(this);this.on("enemy",o),DirectMovement(this),this.on("equippable",this.equip.bind(this))};ExampleMinion.prototype=Object.create(Movable.prototype);for(var name in Damageable.prototype)ExampleMinion.prototype[name]=Damageable.prototype[name];ExampleMinion.prototype.constructor=ExampleMinion,ExampleMinion.prototype.getDamageableShape=function(){return FixtureHelper.circle(this.config.damageableRadius)},ExampleMinion.prototype.equip=function(e){return e.isArmor?this.useArmor(e):void 0},defaultConfig={hp:10,walkSpeed:10,damageableRadius:2,element:-1};
},{"../../Dungeon/Combat/AI/target-finders/ear-range":12,"../../Dungeon/Combat/AI/target-processors/move-to-target":13,"../../Dungeon/Combat/Damageable":17,"../../Dungeon/Entity/Moveable":26,"../../General/Movement/direct-control":42,"../../Helpers/box2d/Fixture":46,"events":51}],4:[function(require,module,exports){
"use strict";var B2D=Module,Vec2=B2D.b2Vec2,Role=require("../../Dungeon/Tower/Room/Role"),ParsedWeapon=require("../../Dungeon/Combat/Weapon/parsed-weapon"),DROPPABLE={Weapons:{Hammer:ParsedWeapon.bind(void 0,require("../Weapons/Hammer.json")),BasicSensor:ParsedWeapon.bind(void 0,require("../Weapons/BasicSensor.json"))},Armor:{BasicSensor:require("../Armor/BasicMinus")}},D_CATEGORIES=Object.keys(DROPPABLE),ExampleDroppableRoom=module.exports=function(){Role.call(this,ExampleDroppableRoom);var o=this.floor.tower.game,e=o.rng,r=DROPPABLE[D_CATEGORIES[Math.floor(D_CATEGORIES.length*e())]],a=Object.keys(r);console.log(a);var l=e();console.log(l),l*=a.length,console.log(l),l=Math.floor(l),console.log(l);var p=r[a[l]];console.log(this.location),this.floor.addEntity(new p(o),new Vec2(this.location.x,this.location.y).mul(2*this.floor.scale))};ExampleDroppableRoom.prototype=Object.create(Role.prototype),ExampleDroppableRoom.prototype.constructor=ExampleDroppableRoom,ExampleDroppableRoom.roleName="ExampleDroppableRoom",ExampleDroppableRoom.prototype.spawnRole=function(){},ExampleDroppableRoom.prototype.destroyRole=function(){};
},{"../../Dungeon/Combat/Weapon/parsed-weapon":23,"../../Dungeon/Tower/Room/Role":31,"../Armor/BasicMinus":2,"../Weapons/BasicSensor.json":6,"../Weapons/Hammer.json":8}],5:[function(require,module,exports){
"use strict";var B2D=Module,Vec2=B2D.b2Vec2,Role=require("../../Dungeon/Tower/Room/Role"),MINIONS=[require("../Minions/move-to-hear")],ExampleMinionRoom=module.exports=function(){Role.call(this,ExampleMinionRoom);var o=this.floor,e=this.floor.tower.game,n=e.rng,t=MINIONS[Math.floor(MINIONS.length*n())],i=new t(e),r=function(){o.tower.currentFloor===o&&(o.removeEntity(i),i.removeListener("destroy",r))};i.on("destroy",r),console.log(this.location),o.addEntity(i,new Vec2(this.location.x,this.location.y).mul(2*this.floor.scale))};ExampleMinionRoom.prototype=Object.create(Role.prototype),ExampleMinionRoom.prototype.constructor=ExampleMinionRoom,ExampleMinionRoom.roleName="ExampleMinionRoom",ExampleMinionRoom.prototype.spawnRole=function(){},ExampleMinionRoom.prototype.destroyRole=function(){};
},{"../../Dungeon/Tower/Room/Role":31,"../Minions/move-to-hear":3}],6:[function(require,module,exports){
module.exports={
  "damage": 5,
  "bodies":{
    "AttackCircle":{
      "main": true,
      "angle": {"relative":"owner"},
      "position": {"relative":"owner", "offset":4},
      "fixtures": [
        {
          "type":"Circle",
          "sensor": true,
          "radius": 3,
          "damager": true
        }
      ]
    }
  },
  "joints": {
    "Connection": {
      "type": "Weld",
      "bodies": ["owner", "AttackCircle"]
    }
  },
  "animations": {
    "idle": {
      "always": true
    },
    "setup": {
      "time": 20
    },
    "attack": {
      "time": 30
    },
    "cancel": {
      "time": 20
    },
    "falter": {
      "time": 10
    }
  }
}

},{}],7:[function(require,module,exports){
"use strict";var Weapon=require("../../Dungeon/Combat/Weapon"),FxH=require("../../Helpers/box2d/Fixture"),Vec2=Module.b2Vec2,tVec=new Vec2,WeldJointDef=Module.b2WeldJointDef,STATES=Weapon.STATES,BasicSensor=module.exports=function(t){Weapon.call(this,t,5,5),this.frame=0,this.joint=void 0,this.on("body",function(t){if(this.owner){tVec.set(5,0);var o=FxH.circle(3,tVec);o.set_isSensor(!0),o.set_density(1);var e=t.CreateFixture(o);e.damager=this}}.bind(this)),this.on("spawn",function(){if(this.owner){var o=new WeldJointDef;o.Initialize(this.owner.body,this.body,this.owner.body.GetWorldCenter()),this.joint=t.world.CreateJoint(o)}}.bind(this)),this.on("pre-destroy",function(){if(this.joint){var o=this.joint;this.joint=void 0,0!==o.ptr&&t.world.DestroyJoint(o)}}.bind(this))};BasicSensor.prototype=Object.create(Weapon.prototype),BasicSensor.prototype.constructor=BasicSensor,BasicSensor.prototype.doSetup=function(){var t=0;return function(){return t+=1,20===t?!0:void 0}},BasicSensor.prototype.doIdle=function(){var t=0;return function(){t=(t+1)%10}},BasicSensor.prototype.doAttack=function(){var t=0;return function(){return t+=1,30===t?!0:void 0}},BasicSensor.prototype.doCancel=function(){var t=0;return function(){return t+=1,20===t?!0:void 0}},BasicSensor.prototype.doFalter=function(){var t=0;return function(){return t+=1,10===t?!0:void 0}};
},{"../../Dungeon/Combat/Weapon":22,"../../Helpers/box2d/Fixture":46}],8:[function(require,module,exports){
module.exports={
  "damage": 5,
  "bodies":{
    "Hand":{
      "main": false,
      "angle": {"relative":"owner"},
      "position": {"relative":"owner"},
      "fixtures": [
        {
          "type":"Circle",
          "sensor": true,
          "radius": 1,
          "position": {"x": 4, "y": 0}
        }
      ]
    },
    "Hammer": {
      "main": true,
      "angle": {"relative": "Hand", "offset": 0.5},
      "position": {"relative": "Hand"},
      "fixtures": [
        {
          "type": "Rectangle",
          "damager": "true",
          "position": {"x": 0, "y": 1},
          "dimension": {"x": 3, "y": 1}
        },
        {
          "type": "Rectangle",
          "position": {"x": 0, "y": -4},
          "dimension": {"x": 1, "y": 4},
          "density": 0.3
        }
      ]
    }
  },
  "joints": {
    "Hand": {
      "type": "Revolute",
      "controlled": true,
      "limit": [0.5, -0.5],
      "bodies": ["owner", "Hand"]
    },
    "Hammer": {
      "type": "Prismatic",
      "controlled": true,
      "angle": 0,
      "limit": [0, -8],
      "bodies": ["Hand", "Hammer"]
    }
  },
  "animations": {
    "idle": {
      "always": true,
      "targets": [
        {"joint": "Hammer", "offset": 0},
        {"joint": "Hand", "offset": 0.5}
      ]
    },
    "setup": {
      "targets": [
        {"joint": "Hammer", "offset": -8},
        {"joint": "Hand", "offset": 0.5}
      ]
    },
    "attack": {
      "always": true,
      "targets": [
        {"joint": "Hammer", "offset": -8},
        {"joint": "Hand", "speed": -1}
      ]
    },
    "cancel": {
      "targets": [
        {"joint": "Hammer", "offset": 0},
        {"joint": "Hand", "offset": 0.5}
      ]
    },
    "falter": {
      "time": 10
    }
  }
}

},{}],9:[function(require,module,exports){
"use strict";var Weapon=require("../../Dungeon/Combat/Weapon"),FiH=require("../../Helpers/box2d/Filter"),FxH=require("../../Helpers/box2d/Fixture"),Vec2=Module.b2Vec2,B2D=Module,BodyDef=B2D.b2BodyDef,PrismaticJointDef=B2D.b2PrismaticJointDef,RevoluteJointDef=B2D.b2RevoluteJointDef,PrismaticJoint=B2D.b2PrismaticJoint,RevoluteJoint=B2D.b2RevoluteJoint,pidiv12=Math.PI/12,tVec=new Vec2,STATES=Weapon.STATES,Hammer=module.exports=function(t){Weapon.call(this,t,5,5),this.frame=0,this.handJoint=void 0,this.staffPositionJoint=void 0,this.handBody=void 0,this.staffMass=void 0,this.on("bodyDef",function(t){this.owner&&t.set_angle(this.owner.body.GetAngle()+Math.PI/2)}),this.on("body",function(e){if(this.owner){tVec.set(2,0);var o=FxH.rect(2,4,tVec,0);o.set_density(4);var i=e.CreateFixture(o);i.damager=this,tVec.set(-4,0);var n=FxH.rect(8,1,tVec,0);n.set_density(1),e.CreateFixture(n),tVec.setAngle(e.GetAngle()).mul(3);var s=new BodyDef;s.set_type(B2D.b2_dynamicBody),s.set_position(tVec.add(this.position)),s.set_fixedRotation(!1),s.set_angle(e.GetAngle()),this.handBody=t.world.CreateBody(s),tVec.set(0,0);var r=FxH.circle(1,tVec);r.set_isSensor(!0),r.set_density(.3),tVec.set(0,0),this.handBody.CreateFixture(r),tVec.set(0,1);var a=new PrismaticJointDef;a.set_bodyA(this.handBody),a.set_bodyB(e),a.set_enableLimit(!0),a.set_upperTranslation(0),a.set_lowerTranslation(-9),a.set_localAxisA(tVec),a.set_enableMotor(!0),a.set_collideConnected(!1),a.set_maxMotorForce(4.5*this.body.GetMass()*60),this.staffPositionJoint=B2D.wrapPointer(t.world.CreateJoint(a),PrismaticJoint)}}.bind(this)),this.on("spawn",function(){if(this.owner){tVec.set(B2D.wrapPointer(this.owner.body.GetWorldCenter(),Vec2)).sub(B2D.wrapPointer(this.handBody.GetWorldCenter(),Vec2));var e=new RevoluteJointDef;e.set_bodyA(this.owner.body),e.set_bodyB(this.handBody),e.set_localAnchorB(tVec),e.set_enableLimit(!0),e.set_lowerAngle(-(pidiv12+Math.PI/2)),e.set_upperAngle(Math.PI/2+pidiv12),e.set_collideConnected(!1),e.set_enableMotor(!0),e.set_maxMotorTorque(2*Math.PI*this.body.GetMass()*60),this.handJoint=B2D.wrapPointer(t.world.CreateJoint(e),RevoluteJoint),console.log(this.body.currentGroup),FiH.newGroup([this.body,this.handBody])}}.bind(this)),this.on("pre-destroy",function(){if(this.handJoint){var e=this.handJoint;this.handJoint=void 0,0!==e.ptr&&(t.world.DestroyJoint(e),e=this.staffPositionJoint,this.staffPositionJoint=void 0,0!==e.ptr&&(t.world.DestroyJoint(e),t.world.DestroyBody(this.handBody),this.handBody=void 0))}}.bind(this))};Hammer.prototype=Object.create(Weapon.prototype),Hammer.prototype.constructor=Hammer,Hammer.prototype.doIdle=function(){return function(){var t=this.staffPositionJoint.GetJointTranslation();this.staffPositionJoint.SetMotorSpeed(10*-t);var e=this.handJoint.GetJointAngle();this.handJoint.SetMotorSpeed(10*-e)}.bind(this)},Hammer.prototype.doAttack=function(){var t,e,o,i,n,s,r=!0;return function(){if(r)t=this.staffPositionJoint.GetLowerLimit(),e=this.staffPositionJoint.GetJointTranslation(),o=t-e,this.staffPositionJoint.SetMotorSpeed(o),n=this.handJoint.GetJointAngle(),i=this.handJoint.GetUpperLimit(),s=i-n,this.handJoint.SetMotorSpeed(s),Math.abs(o)-.1<=0&&Math.abs(s)-.1<=0&&(r=!1);else{i=this.handJoint.GetLowerLimit();var a=this.handJoint.GetUpperLimit();if(this.handJoint.SetMotorSpeed(i-a),n=this.handJoint.GetJointAngle(),Math.abs(i-n)-.1<=0)return!0}}.bind(this)},Hammer.prototype.doCancel=function(){var t,e,o,i,n,s;return function(){return t=this.staffPositionJoint.GetJointTranslation(),e=0,o=e-t,this.staffPositionJoint.SetMotorSpeed(o),i=this.handJoint.GetJointAngle(),n=0,s=n-i,this.handJoint.SetMotorSpeed(s),Math.abs(o)-.1<=0&&Math.abs(s)-.1<=0?!0:void 0}.bind(this)},Hammer.prototype.doFalter=function(){var t=0;return function(){return t+=1,10===t?!0:void 0}};
},{"../../Dungeon/Combat/Weapon":22,"../../Helpers/box2d/Filter":45,"../../Helpers/box2d/Fixture":46}],10:[function(require,module,exports){
"use strict";module.exports={Rooms:{ExampleDroppableRoom:require("./Rooms/ExampleDroppableRoom"),ExampleMinionRoom:require("./Rooms/ExampleMinionRoom")},Weapons:{BasicSensor:require("./Weapons/BasicSensor.js"),Hammer:require("./Weapons/Hammer.js")},Armor:{BasicMinus:require("./Armor/BasicMinus.js")}};
},{"./Armor/BasicMinus.js":2,"./Rooms/ExampleDroppableRoom":4,"./Rooms/ExampleMinionRoom":5,"./Weapons/BasicSensor.js":7,"./Weapons/Hammer.js":9}],11:[function(require,module,exports){
"use strict";var NI=Number.NEGATIVE_INFINITY,PI=Number.POSITIVE_INFINITY;module.exports=function(e,t){var r=e.team,a=t.team;switch(r){case NI:return e.emit("enemy",t);case PI:return e.emit("ally",t);case 0:return e.emit("neutral",t);case void 0:return e.emit("neutral",t);case a:return e.emit("ally",t)}switch(a){case NI:return e.emit("enemy",t);case PI:return e.emit("ally",t);case 0:return e.emit("neutral",t);case void 0:return e.emit("neutral",t)}return e.emit("enemy",t)};
},{}],12:[function(require,module,exports){
"use strict";var FxH=require("../../../../Helpers/box2d/Fixture"),TeamEmitter=require("../alliance-processers/team");module.exports=function(e,r){e.on("body",function(t){var i=FxH.circle(r||10);i.set_isSensor(!0);var o=t.CreateFixture(i);e.onContactStart(o,function(r,t,i){if(i.collisionEmitter){var o=i.collisionEmitter.emitter;o.isPlayer&&TeamEmitter(e,o)}})})};
},{"../../../../Helpers/box2d/Fixture":46,"../alliance-processers/team":11}],13:[function(require,module,exports){
"use strict";var Vec2=Module.b2Vec2,b2Body=Module.b2Body,Entity=require("../../../Entity");module.exports=function(e){var o=e.game,n=e.controller,t=new Vec2,i=void 0,r=!1,d=function(){if(void 0!==i){var o=e.body.GetWorldCenter();if(!r&&i.equals(o))return void(i=void 0);t.set(i),n.emit("change-direction",e.run("movement-target",t,function(e){return e.sub(o).Normalize(),e}))}},c=function(){i=void 0};return e.on("spawn",o.on.bind(o,"time",d)),e.on("destroy",function(){c(),o.removeListener("time",d)}),function(e,o){r=o;var n;return e instanceof Entity?(n=e.body.GetWorldCenter(),void(n!==i&&(i=n,e.once("destroy",c)))):e instanceof b2Body?void(i=e.body.GetWorldCenter()):e instanceof Vec2?void(i=Vec2):void 0}};
},{"../../../Entity":27}],14:[function(require,module,exports){
"use strict";var Armor=require("./index"),Element=require("../Element"),Unequipped=module.exports=function(e){Armor.call(this,e.game),this.setOwner(e),this.element=e.element};Unequipped.prototype=Object.create(Armor.prototype),Unequipped.prototype.constructor=Unequipped,Unequipped.prototype.modifyDamage=function(e){return Element.scaleDamage(this,e)};
},{"../Element":18,"./index":15}],15:[function(require,module,exports){
"use strict";var PPEE=require("../../../Abstract/pre-post-ee"),Equippable=require("../Equippable"),Armor=module.exports=function(e,r){Equippable.call(this,e),PPEE.call(this),this.isArmor=!0,this.element=r,this.game=e,this.modifyDamage=this.modifyDamage.bind(this),this.on("equip",function(e){e.pre("damage",this.modifyDamage)}),this.on("unequip",function(e){e.unPre("damage",this.modifyDamage)})};Armor.prototype=Object.create(Equippable.prototype);for(var i in PPEE)Armor.prototype[i]=PPEE.prototype[i];Armor.prototype.constructor=Armor,Armor.prototype.modifyDamage=function(){throw new Error("modifyDamage is Abstract and needs to be overridden")};
},{"../../../Abstract/pre-post-ee":1,"../Equippable":19}],16:[function(require,module,exports){
"use strict";var STATES=require("./Weapon/STATES.json"),UnEquippedWeapon=require("./Weapon/Unequipped"),Controllable=require("../Entity/Controllable"),Attacker=module.exports=function(t,e,i){Controllable.call(this,t,e),e.on("attack",this.attack.bind(this)),this.game=t,this.weapon=new UnEquippedWeapon(this),this.cancel=this.cancel.bind(this),this.idle=this.idle.bind(this),this.falter=this.falter.bind(this),this.game.on("post-debugDraw",function(t){t.DrawText(this.weapon.attackState,this.body.GetWorldCenter(),10,"#000")}.bind(this)),i&&this.useWeapon(i)};Attacker.prototype=Object.create(Controllable.prototype),Attacker.prototype.constructor=Attacker,Attacker.prototype.attack=function(){this.weapon.attack()},Attacker.prototype.idle=function(){this.weapon.idle()},Attacker.prototype.cancel=function(){this.weapon.cancel()},Attacker.prototype.falter=function(){this.weapon.falter()},Attacker.prototype.useWeapon=function(t){this.weapon&&(this.weapon.setOwner(void 0),this.weapon.removeAllListeners("impact"),this.weapon.removeAllListeners("finish"),this.weapon.removeAllListeners("problem")),this.weapon=t,this.weapon.setOwner(this),this.weapon.on("impact",this.emit.bind(this,"weapon-impact")),this.weapon.on("finish",this.emit.bind(this,"weapon-ready")),this.weapon.on("problem",this.emit.bind(this,"weapon-problem")),this.weapon.on("attack",this.emit.bind(this,"weapon-attack"))};
},{"../Entity/Controllable":25,"./Weapon/STATES.json":20,"./Weapon/Unequipped":21}],17:[function(require,module,exports){
"use strict";var Entity=require("../Entity"),PPEE=require("../../Abstract/pre-post-ee"),UnEquippedArmor=require("./Armor/Unequipped"),Damageable=module.exports=function(e,t,a){Entity.call(this,e),PPEE.call(this),this.hp=t,this.armor=new UnEquippedArmor(this),this.applyDamage=this.applyDamage.bind(this),this.on("body",function(e){var t=this.getDamageableShape();t.set_density(1),this.damageableFixture=e.CreateFixture(t),this.damageableFixture.damageable=this,this.onContactStart(this.damageableFixture,this.applyDamage)}.bind(this)),a&&this.useArmor(a)};Damageable.prototype=Object.create(Entity.prototype);for(var i in PPEE.prototype)Damageable.prototype[i]=PPEE.prototype[i];Damageable.prototype.constructor=Damageable,Damageable.prototype.getDamageableShape=function(){throw new Error("getDamageableFixture is abstract and needs to be overridden")},Damageable.prototype.applyDamage=function(e,t,a){if(a.damager){if(t.impulse){var i=t.impulse.get_normalImpulse()[0],r=this.armor.impactThreshhold||1;if(r>=i)return}var s=this.hp;this.run("damage",a.damager.getDamage(),function(e){return s-=e.value,e}),this.hp=s,this.hp<=0&&this.game.nextTime(this.checkIsDead.bind(this))}},Damageable.prototype.checkIsDead=function(){this.hp>0||(this.emit("die",this),this.destroy())},Damageable.prototype.useArmor=function(e){this.armor.setOwner(void 0),this.armor=e,this.armor.setOwner(this)};
},{"../../Abstract/pre-post-ee":1,"../Entity":27,"./Armor/Unequipped":14}],18:[function(require,module,exports){
"use strict";module.exports.scaleDamage=function(e,t){if(t.element===e.element)return t;if(!t.element)return t.value*=.75,t;if(!e.element)return t.value*=1.25,t;var n=e.element,l=t.element,r=(n-l+3)%3,u=0===r?1:1===r?2:2===r?.5:0;return t.value*=u,t};
},{}],19:[function(require,module,exports){
"use strict";var Entity=require("../Entity"),FixtureHelper=require("../../Helpers/box2d/Fixture"),Equippable=module.exports=function(e,t){Entity.call(this,e,t),this.owner=void 0,this.on("body",this.dungeonBody.bind(this)),this.unEquip=this.setOwner.bind(this,void 0)};Equippable.prototype=Object.create(Entity.prototype),Equippable.prototype.constructor=Equippable,Equippable.prototype.dungeonBody=function(e){if(!this.owner){var t=FixtureHelper.circle(3);t.set_isSensor(!0);var i=this,r=e.CreateFixture(t);i.onContactStart(r,function(e,t,r){if(!r.IsSensor()&&r.collisionEmitter){var o=r.collisionEmitter.emitter;o instanceof Equippable||o instanceof Entity&&o!==i.oldOwner&&i.game.nextTime(o.emit.bind(o,"equippable",i))}}),i.onContactEnd(r,function(e,t,r){if(r.collisionEmitter){var o=r.collisionEmitter.emitter;o===i.oldOwner&&(i.oldOwner=void 0)}})}},Equippable.prototype.setOwner=function(e){if(!this.owner&&!e)throw new Error("need to either: equip to an existant new Owner or Unequipped from current Owner");var t=this.owner;if(this.owner=void 0,t)this.oldOwner=t,t.removeListener("die",this.unEquip),this.emit("unequip",t,this);else{var i=e.game.tower.currentFloor;i&&i.removeEntity(this)}if(this.owner=e,e)this.oldOwner=void 0,e.on("die",this.unEquip),this.emit("equip",e,this);else{var r=t.game.tower.currentFloor;r&&r.addEntity(this,t.body.GetWorldCenter())}};
},{"../../Helpers/box2d/Fixture":46,"../Entity":27}],20:[function(require,module,exports){
module.exports={
  "IDLE": "idleing",
  "SETUP": "setting-up",
  "ATTACK": "attacking",
  "CANCEL": "canceling",
  "FALTER": "faltering",
  "DORMANT": "sleeping"
}
},{}],21:[function(require,module,exports){
"use strict";var Weapon=require("./index"),Unequipped=module.exports=function(e){Weapon.call(this,e.game,5,5),this.element=e.element,this.setOwner(e)};Unequipped.prototype=Object.create(Weapon.prototype),Unequipped.prototype.constructor=Unequipped,Unequipped.prototype.doIdle=function(){var e=0;return function(){e=(e+1)%10}},Unequipped.prototype.doSetup=function(){var e=0;return function(){return e+=1,10===e?!0:void 0}},Unequipped.prototype.doAttack=function(){var e=0;return function(){return e+=1,10===e?!0:void 0}},Unequipped.prototype.doCancel=function(){var e=0;return function(){return e+=1,10===e?!0:void 0}},Unequipped.prototype.doFalter=function(){var e=0;return function(){return e+=1,10===e?!0:void 0}};
},{"./index":22}],22:[function(require,module,exports){
"use strict";var Equippable=require("../Equippable"),FilterHelper=require("../../../Helpers/box2d/Filter"),STATES=require("./STATES.json"),Weapon=module.exports=function(t,e,i){Equippable.call(this,t),this.isWeapon=!0,this.expense=i,this.damage=e,this.attackState=STATES.DORMANT,this.doTime=this.doTime.bind(this),this.doEquip=this.doEquip.bind(this),this.doUnequip=this.doUnequip.bind(this),this.handleSpawning=this.handleSpawning.bind(this),this.destroy=this.destroy.bind(this),this.on("equip",this.doEquip),this.on("unequip",this.doUnequip),this.on("bodyDef",function(t){this.owner&&t.set_angle(this.owner.body.GetAngle())}),this.on("spawn",function(){this.owner&&(this.onContactStart(this.body,function(t,e,i){i.IsSensor()||t.damager?this.emit("impact",i):this.falter()}),FilterHelper.newGroup([this.body,this.owner.body]),FilterHelper.makeUncollidable(this.body))}.bind(this))};Weapon.prototype=Object.create(Equippable.prototype),Weapon.prototype.constructor=Weapon,Weapon.prototype.doEquip=function(t){this.game.on("time",this.doTime),t.world&&this.handleSpawning(),t.on("spawn",this.handleSpawning),t.on("destroy",this.destroy),this.idle()},Weapon.prototype.handleSpawning=function(){this.spawn(this.owner.game.world,this.owner.body.GetWorldCenter())},Weapon.prototype.doUnequip=function(t,e){this.destroy(),this.game.removeListener("time",this.doTime),FilterHelper.resetCollidable(this.body),FilterHelper.removeFromGroup(this.body),e.removeListener("spawn",this.handleSpawning),e.removeListener("destroy",this.destroy),this.dormant()},Weapon.prototype.doTime=function(){if(this.current())switch(this.attackState){case STATES.IDLE:return void this.setup();case STATES.SETUP:return void this.attack();case STATES.ATTACK:return void this.cancel();case STATES.FALTER:return void this.cancel();case STATES.CANCEL:return void this.idle()}},Weapon.prototype.setup=function(){FilterHelper.resetCollidable(this.body),this.attackState=STATES.SETUP,this.current=this.doSetup()},Weapon.prototype.attack=function(){switch(this.attackState){case STATES.IDLE:return void this.setup();case STATES.ATTACK:return void this.cancel();case STATES.CANCEL:return void this.falter();case STATES.FALTER:return void this.falter()}this.emit("attack",this),this.attackState=STATES.ATTACK,this.current=this.doAttack()},Weapon.prototype.cancel=function(){return this.attackState===STATES.CANCEL?this.falter():(FilterHelper.makeUncollidable(this.body),this.attackState=STATES.CANCEL,void(this.current=this.doCancel()))},Weapon.prototype.idle=function(){this.emit("finish"),this.attackState=STATES.IDLE,this.current=this.doIdle()},Weapon.prototype.dormant=function(){this.attackState=STATES.DORMANT},Weapon.prototype.falter=function(){this.emit("falter"),FilterHelper.makeUncollidable(this.body),this.attackState=STATES.FALTER,this.current=this.doFalter()},Weapon.prototype.attachToOwner=function(){throw new Error("attachToOwner is abstract and needs to be implemented")},Weapon.prototype.getDamage=function(){return{value:this.damage}},Weapon.STATES=STATES;
},{"../../../Helpers/box2d/Filter":45,"../Equippable":19,"./STATES.json":20}],23:[function(require,module,exports){
"use strict";var Weapon=require("./index"),FiH=require("../../../Helpers/box2d/Filter"),FxH=require("../../../Helpers/box2d/Fixture"),parser=require("./parser"),B2D=Module,STATES=Weapon.STATES,ParsedWeapon=module.exports=function(e,i){Weapon.call(this,i,e.damage,5),this.frame=0,this.config=e,this.bodydefs={},this.bodies={},this.joints={},this.isEquipped=!1;var t=Object.keys(e.bodies),s=t.length,o=Object.keys(e.joints),r=o.length;this.on("bodyDef",function(i){if(this.owner){this.isEquipped=!0;for(var o=0;s>o;o++){var r=t[o],n=e.bodies[r],a=parser.mainOrNewDef(n,i);parser.bodyDefParser(a,n,this.owner.body,this.bodydefs),this.bodydefs[r]=a}}}.bind(this)),this.on("body",function(o){if(this.owner)for(var r=0;s>r;r++){var n,a=t[r],d=e.bodies[a];if(n=d.main?o:i.world.CreateBody(this.bodydefs[a]),this.bodies[a]=n,!d.fixtures||!d.fixtures.length)throw new Error("need to provide at least one fixture for body["+a+"]");for(var h,p=d.fixtures,f=0,u=p.length;u>f;f++)h=n.CreateFixture(FxH.fromConfig(p[f])),p[f].damager&&(h.damager=this)}}.bind(this)),this.on("spawn",function(){if(this.owner){var s=this.bodies,n=t.map(function(e){return s[e]});FiH.newGroup([this.owner.body].concat(n));for(var a=0;r>a;a++){var d=o[a],h=e.joints[d];this.joints[d]=parser.jointParser(h,i.world,this.owner.body,this.bodies)}}}.bind(this)),this.on("pre-destroy",function(){if(this.isEquipped){var t;for(t in this.joints){var s=this.joints[t];delete this.joints[t],0!==s.ptr&&i.world.DestroyJoint(s.ptr)}for(t in this.bodies)e.bodies[t].main||(i.world.DestroyBody(this.bodies[t]),delete this.bodies[t],this.bodydefs[t].__destroy__(),delete this.bodydefs[t]);this.isEquipped&&!this.owner&&(this.isEquipped=!1)}}.bind(this))};ParsedWeapon.prototype=Object.create(Weapon.prototype),ParsedWeapon.prototype.constructor=ParsedWeapon,ParsedWeapon.prototype.doIdle=function(){var e=this.config.animations.idle;return parser.animParser(e,this.joints,this.bodies)},ParsedWeapon.prototype.doSetup=function(){var e=this.config.animations.setup;return parser.animParser(e,this.joints,this.bodies)},ParsedWeapon.prototype.doAttack=function(){var e=this.config.animations.attack;return parser.animParser(e,this.joints,this.bodies)},ParsedWeapon.prototype.doCancel=function(){var e=this.config.animations.cancel;return parser.animParser(e,this.joints,this.bodies)},ParsedWeapon.prototype.doFalter=function(){var e=this.config.animations.falter;return parser.animParser(e,this.joints,this.bodies)};
},{"../../../Helpers/box2d/Filter":45,"../../../Helpers/box2d/Fixture":46,"./index":22,"./parser":24}],24:[function(require,module,exports){
"use strict";var B2D=Module,BodyDef=B2D.b2BodyDef,Vec2=B2D.b2Vec2,tVec=new Vec2,getRelative,parseAnimationTarget,doFn;module.exports.mainOrNewDef=function(e,t){if(e.main)return t;var i=new BodyDef;return i.set_type(B2D.b2_dynamicBody),i.set_fixedRotation(!1),i},module.exports.bodyDefParser=function(e,t,i,n){var o;if(t.angle){var r=t.angle,a=0;o=getRelative(r.relative,i,n),a="owner"===r.relative?o.GetAngle():o.get_angle(),r.offset&&(a+=Math.PI*r.offset),e.set_angle(a)}else e.set_angle(i.GetAngle());if(t.position){var s=t.position,l=new Vec2;o=getRelative(s.relative,i,n),"owner"===s.relative?l.set(o.GetPosition()):l.set(o.get_position()),s.offset&&("number"==typeof s.offset?(tVec.setAngle(e.get_angle()),l.add(tVec.mul(s.offset))):(s.offset.x&&l.add(s.offset.x,0),s.offset.y&&l.add(0,s.offset.y))),e.set_position(l)}else e.set_position(i.GetPosition());return e};var PrismaticJointDef=B2D.b2PrismaticJointDef,PrismaticJoint=B2D.b2PrismaticJoint,RevoluteJointDef=B2D.b2RevoluteJointDef,RevoluteJoint=B2D.b2RevoluteJoint,WeldJointDef=B2D.b2WeldJointDef,WeldJoint=B2D.b2WeldJoint;module.exports.jointParser=function(e,t,i,n){var o,r,a=getRelative(e.bodies[0],i,n),s=getRelative(e.bodies[1],i,n);switch(e.type.toLowerCase()){case"weld":return o=new WeldJointDef,o.Initialize(a,s,this.owner.body.GetWorldCenter()),B2D.wrapPointer(t.CreateJoint(o).ptr,WeldJoint);case"revolute":return o=new RevoluteJointDef,o.set_bodyA(a),o.set_bodyB(s),r=2*Math.PI,e.limit&&(e.limit[0]*=Math.PI,e.limit[1]*=Math.PI,o.set_enableLimit(!0),o.set_upperAngle(e.limit[0]),o.set_lowerAngle(e.limit[1]),r=e.limit[0]-e.limit[1]),e.controlled&&(o.set_enableMotor(!0),o.set_maxMotorTorque(r*(a.GetMass()+s.GetMass())*60)),B2D.wrapPointer(t.CreateJoint(o).ptr,RevoluteJoint);case"prismatic":return tVec.set(0,1),o=new PrismaticJointDef,o.set_bodyA(a),o.set_bodyB(s),r=5,e.limit&&(o.set_enableLimit(!0),o.set_upperTranslation(e.limit[0]),o.set_lowerTranslation(e.limit[1]),r=e.limit[0]-e.limit[1]),e.angle&&(tVec.setAngle(e.angle),o.set_localAxisA(tVec)),e.controlled&&(o.set_enableMotor(!0),o.set_maxMotorForce(r*(a.GetMass()+s.GetMass())*60)),B2D.wrapPointer(t.CreateJoint(o).ptr,PrismaticJoint)}throw new Error("cannot create joint of type "+e.type)},module.exports.animParser=function(e,t,i){var n=0;if(!e.targets)return e.time?function(){return n++>=e.time?!e.always:void 0}:function(){return!e.always};var o=e.targets.map(parseAnimationTarget.bind(void 0,t,i));return e.always?o.forEach.bind(o,function(e){e()}):e.time?function(){return o.forEach(function(t){t(e.time-n)}),n++>=e.time?!0:void 0}:o.reduce.bind(o,function(e,t){return e&&t()},!0)},parseAnimationTarget=function(e,t,i){if("joint"in i){var n=e[i.joint];if("offset"in i){var o=i.offset*(n.GetJointAngle?Math.PI:1);return function(e){var t=n.GetJointAngle?n.GetJointAngle():n.GetJointTranslation(),i=o-t;return Math.abs(i)-.1<=1?!0:(i=e?i/e:i,void n.SetMotorSpeed(i))}}if("speed"in i){var r=i.speed;return function(){return n.SetMotorSpeed(r*(n.GetJointAngle?Math.PI:1)),!0}}}throw new Error("cannot animate non body non joint")},module.exports.getRelative=getRelative=function(e,t,i){if(!e)return t;if("owner"===e)return t;if(e in i)return i[e];throw new Error("relative["+e+"] does not exist")},doFn=function(e,t,i){return t&&i(e)};
},{}],25:[function(require,module,exports){
"use strict";var Entity=require("./index"),PPEE=require("../../Abstract/pre-post-ee"),Controllable=module.exports=function(t,o){this.controller||(Entity.call(this,t),PPEE.call(this),this.controller=o)};Controllable.prototype=Object.create(Entity.prototype);for(var i in PPEE)Controllable.prototype[i]=PPEE.prototype[i];Controllable.prototype.constructor=Controllable;
},{"../../Abstract/pre-post-ee":1,"./index":27}],26:[function(require,module,exports){
"use strict";var B2d=Module,Vec2=B2d.b2Vec2,Controllable=require("./Controllable"),impulse=new Vec2,Movable=module.exports=function(e,t){Controllable.call(this,e,t),t.on("change-direction",function(e){this.newDirection.set(e.get_x(),e.get_y())}.bind(this)),this.newDirection=new Vec2,this.oldDirection=new Vec2,this.doMovement=this.doMovement.bind(this),this.on("spawn",e.on.bind(e,"time",this.doMovement)),this.on("destroy",e.removeListener.bind(e,"time",this.doMovement))};Movable.prototype=Object.create(Controllable.prototype),Movable.prototype.constructor=Controllable,Movable.prototype.doMovement=function(){if(this.body){impulse.SetZero(),impulse.set(this.newDirection),impulse.Normalize();var e=this.body,t=Math.atan2(impulse.get_y(),impulse.get_x());this.run("movement",{angular:t,linear:impulse},function(t){return e.ApplyAngularImpulse(t.angular*e.GetInertia(),e.GetWorldCenter()),e.ApplyLinearImpulse(t.linear.clone().mul(e.GetMass()),e.GetWorldCenter()),t})}},Movable.prototype.useWeapon=function(e){this.weapon.setOwner(void 0),this.weapon=e,this.weapon.setOwner(this)};
},{"./Controllable":25}],27:[function(require,module,exports){
"use strict";var B2d=Module,Vec2=B2d.b2Vec2,BodyDef=B2d.b2BodyDef,ContactEmitter=require("../../General/Collision/ContactEmitter"),hat=require("hat"),Entity=module.exports=function(t,i){if(ContactEmitter.call(this),!(this.game&&this.position&&this.rng)){if(!t)throw new Error("Need A Game Instance");this.position=i?i.clone():new Vec2,this.game=t,this.rng=t.rng}};Entity.prototype=Object.create(ContactEmitter.prototype),Entity.prototype.constructor=Entity,Entity.prototype.spawn=function(t,i){this.world=t,i&&this.position.set(i);var e=new BodyDef;e.set_type(B2d.b2_dynamicBody),e.set_position(this.position),e.set_fixedRotation(!1),this.emit("bodyDef",e);var o=this.body=t.CreateBody(e);o.entity=this,this.emit("body",o),o.SetFixedRotation(!1),this.emit("spawn",this)},Entity.prototype.destroy=function(t){this.emit("pre-destroy",this),t=this.world,this.position.set(this.body.GetWorldCenter()),this.removeContact(this.body),t.DestroyBody(this.body),delete this.body,this.emit("destroy",this)};
},{"../../General/Collision/ContactEmitter":38,"hat":52}],28:[function(require,module,exports){
"use strict";var EntityGen=module.exports=function(){this.entities=[]};EntityGen.prototype.addEntity=function(t,i){var e=this.entities.indexOf(t);if(e>-1)throw new Error("this entity already exists on this floor");this.entities.push(t),t.position.set(i),this.world&&t.spawn(this.world)},EntityGen.prototype.removeEntity=function(t){var i=this.entities.indexOf(t);if(-1===i)throw new Error("this entity doesn't exist on this floor");this.entities.splice(i,1),this.world&&t.body&&t.destroy(this.world)};
},{}],29:[function(require,module,exports){
"use strict";var roomProto=require("./room-setup"),EntityGen=require("./entity-gen"),Floor=module.exports=function(o,t,e,r){EntityGen.call(this),this.tower=t,this.rng=t.game.rng,this.rooms=[],this.roles={},this.lastFloor=o,o&&(o.nextFloor=this),this.generateRooms(o),this.unusedRooms=this.rooms.map(function(o){return o}).sort(function(o,t){return t.depth-o.depth}),this.roles.Start=this.unusedRooms.pop(),this.applyRoles(e,r)};for(var name in roomProto)Floor.prototype[name]=roomProto[name];for(name in EntityGen.prototype)Floor.prototype[name]=EntityGen.prototype[name];Floor.prototype.constructor=Floor,Floor.prototype.applyRoles=function(o,t){for(var e=Object.keys(o),r=e.length;r--&&this.unusedRooms.length;)this.applyRole(o[e[r]]);for(r=this.unusedRooms.length;r--;)t(this.unusedRooms.pop())},Floor.prototype.applyRole=function(o){var t=Math.floor(this.unusedRooms.length*Math.pow(this.rng(),2)),e=this.unusedRooms.splice(t,1)[0];e.setRole(o),this.roles[o.roleName]=e},Floor.prototype.spawn=function(o){this.world=o,this.rooms.forEach(function(t){t.spawn(o)}),this.entities.forEach(function(t){t.spawn(o)})},Floor.prototype.destroy=function(){var o=this.world;delete this.world,this.rooms.forEach(function(t){t.destroy(o)}),this.entities.forEach(function(t){t.destroy(o)})},Floor.prototype.undoRole=function(o){for(var t=o.roleName,e=this.rooms,r=0;r<e.length;r++)if(e[r].roleName===t)return e[r].undoRole()};
},{"./entity-gen":28,"./room-setup":30}],30:[function(require,module,exports){
"use strict";var DIMS=["x","y"],DIRS=[-1,1],Room=require("../Room"),prototype=module.exports={};prototype.generateRooms=function(t){this.generateStack=[],this.maxDepth=10,this.maxRooms=30,this.maxRoomLocation={x:10,y:10},this.scale=20,this.stackLength=0;var o=t?t.roles.End.location:{x:0,y:0};for(this.roles.start=this.createRoom(o),this.roles.start.name="start";this.stackLength;)this.stackLength--,this.generateStack.pop()()},prototype.createRoom=function(t){var o=new Room(t,this);return this.rooms.push(o),o.depth===this.maxDepth?o:(o.iterateAdjacents(function(t,e,i){if(!t){var n=e===DIMS[0]?DIMS[1]:DIMS[0],s={};s[e]=o.location[e],s[n]=o.location[n]+parseInt(i),this.maxRoomLocation[n]<s[n]||this.stackRoom(o.depth+1,s)}}.bind(this)),o)},prototype.stackRoom=function(t,o){if(this.rooms.length!==this.maxRooms){this.stackLength++;var e=Math.round(this.generateStack.length*this.rng());e===this.generateStack.length?this.generateStack.push(this.attemptRoom.bind(this,t,o)):0===e?this.generateStack.unshift(this.attemptRoom.bind(this,t,o)):this.generateStack.splice(e,0,this.attemptRoom.bind(this,t,o))}},prototype.attemptRoom=function(t,o){if(!this.hasRoomAt(o)){var e=this.maxRooms-this.rooms.length;if(e*=(this.maxRoomLocation.x-Math.abs(o.x)+(this.maxRoomLocation.y-Math.abs(o.y)))/2,e/=this.stackLength*this.stackLength+1,!(this.rng()>e)){for(var i=Number.POSITIVE_INFINITY,n=this.getDepths(o),s=[],a=0,r=n.length;r>a;a++){var h=n[a];if(s.indexOf(h)>-1)return;if(h-1===t)return;s.push(h),i=Math.min(i,h)}i>=t||this.createRoom(o)}}},prototype.hasRoomAt=function(t){return this.rooms.some(function(o){return o.location.x===t.x&&o.location.y===t.y})};var checkAdjacent;prototype.getDepths=function(t){return this.rooms.filter(function(o){var e=o.location;if(t.x===e.x){if(checkAdjacent(t,e,"y"))return!0}else if(t.y===e.y&&checkAdjacent(t,e,"x"))return!0;return!1}).map(function(t){return t.depth})},prototype.applyAdjacents=function(t){for(var o,e=this.rooms,i=e.length,n=t.location;i--;)if(e[i]!==t){var s=e[i].location;if(s.y===n.y&&s.x===n.x)throw new Error("We should never have two rooms with same x, y");n.x===s.x?(o=checkAdjacent(n,s,"y"),o&&t.setAdjacent("y",o,e[i])):n.y===s.y&&(o=checkAdjacent(n,s,"x"),o&&t.setAdjacent("x",o,e[i]))}},checkAdjacent=function(t,o,e){for(var i=DIRS.length;i--;)if(o[e]===t[e]+DIRS[i])return DIRS[i];return!1};
},{"../Room":35}],31:[function(require,module,exports){
"use strict";var Role=module.exports=function(e){if(!e.roleName)throw new Error("When creating a Role Class You need to provide the SubRole");this.roleName=e.roleName,this.spawnRole=e.prototype.spawnRole.bind(this),this.destroyRole=e.prototype.destroyRole.bind(this),this.once("spawn",this.spawnRole),this.once("destroy",this.destroyRole),this.undoRole=e.prototype.undoRole.bind(this)};Role.prototype.undoRole=function(){delete this.roleName,this.removeListener("spawn",this.spawnRole),this.removeListener("destroy",this.destroyRole),delete this.spawnRole,delete this.destroyRole,delete this.undoRole},Role.prototype.spawnRole=function(){throw new Error("spawn is an abstract function and needs to be overridden")},Role.prototype.destroyRole=function(){throw new Error("destroy is an abstract function and needs to be overridden")};
},{}],32:[function(require,module,exports){
"use strict";var FixtureHelper=require("../../../../Helpers/box2d/Fixture"),Role=require("../Role"),End=module.exports=function(){Role.call(this,End)};End.prototype=Object.create(Role.prototype),End.prototype.constructor=End,End.roleName="End",End.prototype.spawnRole=function(){var e=this,t=e.body,o=e.floor.scale,r=FixtureHelper.rect(o/4,o/4);r.set_isSensor(!0),r=t.CreateFixture(r),e.endSensor=r,e.onContactStart(r,function(t,o,n){var l=n.damageable;if(l&&l.isPlayer){var a=e.floor.tower;a.game.once("time",a.nextFloor.bind(a)),e.offContactStart(r)}})},End.prototype.destroyRole=function(){delete this.endSensor};
},{"../../../../Helpers/box2d/Fixture":46,"../Role":31}],33:[function(require,module,exports){
"use strict";var DIMS=["x","y"],DIRS=["-1","1"],AdjacentGen=module.exports=function(t,e){this.id=Math.random(),this.location={x:t.x||0,y:t.y||0},this.depth=Math.POSITIVE_INFINITY,this.floor=e,this.adjacent={y:{"-1":void 0,1:void 0},x:{"-1":void 0,1:void 0},length:0},e.applyAdjacents(this),this.depth===Math.POSITIVE_INFINITY&&(this.depth=0)};AdjacentGen.prototype.setDepth=function(t){this.depth<=t||(this.depth=t,this.iterateAdjacents(function(e){e&&e.setDepth(t+1)}))},AdjacentGen.prototype.setAdjacent=function(t,e,h){if(this.adjacent[t][e]){if(h===this.adjacent[t][e])return;throw new Error("There are two different rooms at duplicate locations")}this.adjacent[t][e]=h,this.setDepth(h.depth+1),this.adjacent.length++,h.setAdjacent(t,-1*e,this)},AdjacentGen.prototype.remove=function(){this.iterateAdjacents(function(t,e,h){t&&t.removeAdjacent(e,-1*h)}),this.floor.rooms.splice(this.floor.rooms.indexOf(this),1)},AdjacentGen.prototype.removeAdjacent=function(t,e){var h=this.adjacent[t][e];if(delete this.adjacent[t][e],this.adjacent.length--,!(h.depth>this.depth)){var i=Number.POSITIVE_INFINITY;if(this.iterateAdjacents(function(t){t&&(i=Math.min(t.depth,i))}),i>this.depth)throw new Error("This room is unreachable");if(i<h.depth)throw new Error("This room depth should be the minimums depth + 1");i!==h.depth&&(this.depth=Number.POSITIVE_INFINITY,this.setDepth(i+1))}},AdjacentGen.prototype.iterateAdjacents=function(t){for(var e=this.adjacent,h=DIMS.length;h--;)for(var i=DIMS[h],n=DIRS.length;n--;){var o=DIRS[n];t(e[i][o],i,o)}};
},{}],34:[function(require,module,exports){
"use strict";var B2d=Module,Vec2=B2d.b2Vec2,BodyDef=B2d.b2BodyDef,FixtureHelper=require("../../../Helpers/box2d/Fixture"),proto=module.exports;proto.getLocation=function(){return new Vec2(this.location.x,this.location.y).mul(2*this.floor.scale)},proto.spawn=function(t){var e=this.floor.scale;this.position=new Vec2(this.location.x,this.location.y),this.position.mul(2*e);var o=new BodyDef;o.set_position(this.position),o.set_type(B2d.b2_staticBody),this.body=t.CreateBody(o),this.body.SetUserData(this),this.iterateAdjacents(function(t,o,i){return i=parseInt(i),t?void this.createDoor(o,i,e):this.createWall(o,i,e)}.bind(this)),this.emit("spawn",this)},proto.destroy=function(t){this.removeContact(this.body),t.DestroyBody(this.body),this.emit("destroy",this)},proto.createWall=function(t,e,o){var i,r,s=new Vec2;"x"===t?(s.Set(e*(o-1),0),i=1,r=o):(s.Set(0,e*(o-1)),i=o,r=1),this.body.CreateFixture(FixtureHelper.rect(i,r,s,0))},proto.createDoor=function(t,e,o){var i,r,s=[],n=o/6;if("x"===t){var a=e*(o-1);s.push(new Vec2(a,n-o)),s.push(new Vec2(a,o-n)),i=1,r=o/3}else{var c=e*(o-1);s.push(new Vec2(n-o,c)),s.push(new Vec2(o-n,c)),i=o/3,r=1}var h=this.body;s.forEach(function(t){h.CreateFixture(FixtureHelper.rect(i,r,t,0))})};
},{"../../../Helpers/box2d/Fixture":46}],35:[function(require,module,exports){
"use strict";var ContactEmitter=require("../../../General/Collision/ContactEmitter"),AdjGen=require("./adjacent-generation"),Room=module.exports=function(o,t){if(!o)throw new Error("Rooms require a location");ContactEmitter.call(this),AdjGen.call(this,o,t)};Room.prototype=Object.create(ContactEmitter.prototype),Room.prototype.constructor=Room,Room.prototype.setRole=function(o){o.call(this)};for(var i in AdjGen.prototype)Room.prototype[i]=AdjGen.prototype[i];var box2d=require("./box2d");for(i in box2d)Room.prototype[i]=box2d[i];
},{"../../../General/Collision/ContactEmitter":38,"./adjacent-generation":33,"./box2d":34}],36:[function(require,module,exports){
"use strict";var Floor=require("./Floor"),Tower=module.exports=function(o,r,t,e){this.game=o,this.world=o.world,o.tower=this,t||(t={}),t.End||(t.End=require("./Room/Roles/end")),e||(e=function(){}),this.floors=this.createFloors(r,t,e)};Tower.prototype.createFloors=function(o,r,t){for(var e,s=[],n=0;o>n;n++){var i=new Floor(e,this,r,t);s.push(i),e=i}return e.undoRole(r.End),s},Tower.prototype.nextFloor=function(){var o=this.currentFloor;this.currentFloor=o.nextFloor,o.destroy(this.world),this.currentFloor.spawn(this.world)},Tower.prototype.setFloor=function(o){this.currentFloor&&this.currentFloor.destroy(this.world),this.currentFloor=this.floors[o],this.currentFloor.spawn(this.world)},Tower.prototype.getStart=function(){return this.currentFloor.roles.Start.getLocation()};
},{"./Floor":29,"./Room/Roles/end":32}],37:[function(require,module,exports){
"use strict";var Camera=module.exports=function(t,i,r,s){this.ctx=t,this.cur=i.cur,this.min={x:i.cur.x*i.min,y:i.cur.y*i.min},this.max={x:i.cur.x*i.max,y:i.cur.y*i.max},this.padding={x:i.cur.x*r,y:i.cur.y*r},this.lastPos={x:0,y:0},this.lastDim=this.dim={x:this.cur.x,y:this.cur.y},this.netScale={x:1,y:1},t.translate(-this.cur.x/2,-this.cur.y/2),t.scale(1,-1),this.following=[],this.targets=[],s&&s.on("zoom",function(t){this.padding.x+=this.padding.x*t/2,this.padding.y+=this.padding.y*t/2}.bind(this))};Camera.prototype.moveTo=function(t,i){this.ctx.translate(-t,-i),this.lastPos={x:t,y:i}},Camera.prototype.setSize=function(t,i){var r={x:this.cur.x/t,y:this.cur.y/i};this.ctx.scale(r.x,r.y),this.lastDim={x:t,y:i}},Camera.prototype.rotate=function(t){this.ctx.rotate(t)},Camera.prototype.step=function(t){var i=this.padding,r={max:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY},min:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY}};this.following.forEach(function(t){var s=t.GetWorldCenter();r.max.x=Math.max(r.max.x,s.get_x()+i.x),r.max.y=Math.max(r.max.y,s.get_y()+i.y),r.min.x=Math.min(r.min.x,s.get_x()-i.x),r.min.y=Math.min(r.min.y,s.get_y()-i.y)}),this.targets.forEach(function(i){var s,o=Math.min(1,t/i.time);i.desiredPosition?(i.currentPosition.x+=o*(i.desiredPosition.x-i.currentPosition.x),i.currentPosition.y+=o*(i.desiredPosition.y-i.currentPosition.y),s=i.currentPosition):s=this.currentPosition;var n;i.desiredDim?(i.currentDim.x+=o*(i.desiredDim.x-i.currentDim.x),i.currentDim.y+=o*(i.desiredDim.y-i.currentDim.y),n=i.currentDim):n=this.currentPosition,i.time=Math.max(0,i.time-t),r.max.x=Math.max(r.x,s.x+n.x/2),r.max.y=Math.max(r.y,s.y+n.y/2),r.min.x=Math.min(r.x,s.x-n.x/2),r.min.y=Math.min(r.y,s.y-n.y/2)});var s={x:Math.min(this.max.x,Math.max(this.min.x,r.max.x-r.min.x)),y:Math.min(this.max.y,Math.max(this.min.y,r.max.y-r.min.y))},o={x:(r.max.x+r.min.x)/2,y:(r.max.y+r.min.y)/2};(o.x!==this.lastPos.x||o.y!==this.lastPos.y||s.x!==this.lastDim.x||s.y!==this.lastDim.y)&&(this.ctx.setTransform(1,0,0,-1,this.cur.x/2,this.cur.y/2),this.setSize(s.x,s.y),this.moveTo(o.x,o.y))},Camera.prototype.follow=function(t){if(-1!==this.following.indexOf(t))throw new Error("already following this body");this.following.push(t)},Camera.prototype.unfollow=function(t){var i=this.following.indexOf(t);if(-1===i)throw new Error("Not following this body anymore");this.following.splice(i,1)},Camera.prototype.goToTarget=function(t,i,r){if(!r)throw new Error("cannot resolve a transform over zero time");this.targets.push({currentPosition:this.lastPos,currentDim:this.lastDim,desiredPosition:t,desiredDim:i,time:r})};
},{}],38:[function(require,module,exports){
"use strict";var EE=require("events").EventEmitter,Box2D=Module,b2Body=Box2D.b2Body,b2Fixture=Box2D.b2Fixture,ContactEmitter=module.exports=function(){this._events||EE.call(this)};ContactEmitter.prototype=Object.create(EE.prototype),ContactEmitter.prototype.constructor=ContactEmitter,ContactEmitter.prototype.onContactStart=function(t,o){this.appendContact(t,o,"-on")},ContactEmitter.prototype.onContactEnd=function(t,o){this.appendContact(t,o,"-off")},ContactEmitter.prototype.appendContact=function(t,o,e){if("function"!=typeof o)throw new Error("the second argument is expected to be a function");if(t instanceof b2Body){for(var i=t.GetFixtureList(),n=[];i.ptr;)n.push(this.appendContact(i,o,e)),i=i.GetNext();return n}if(!(t instanceof b2Fixture))throw new Error("Can only listen to a body or a fixture");return t.collisionEmitter||(t.collisionEmitter={uid:Date.now(),emitter:this}),this.on(t.collisionEmitter.uid+e,o)},ContactEmitter.prototype.offContactStart=function(t,o){this.removeContact(t,o,"-on")},ContactEmitter.prototype.offContactEnd=function(t,o){this.removeContact(t,o,"-off")},ContactEmitter.prototype.removeContact=function(t,o,e){if(t instanceof b2Body){for(var i=t.GetFixtureList(),n=[];i.ptr;)n.push(this.removeContact(i,o,e)),i=i.GetNext();return n}if(!(t instanceof b2Fixture))throw new Error("Can only listen to a body or a fixture");if(t.collisionEmitter)return e?o?this.removeListener(t.collisionEmitter.uid+e,o):this.removeAllListeners(t.collisionEmitter.uid+e):(this.removeAllListeners(t.collisionEmitter.uid+"on"),this.removeAllListeners(t.collisionEmitter.uid+"off"))},ContactEmitter.attemptContact=function(t,o){var e=t.contact,i=e.GetFixtureA(),n=e.GetFixtureB(),r=o?"-on":"-off";i.collisionEmitter&&i.collisionEmitter.emitter.emit(i.collisionEmitter.uid+r,i,t,n),n.collisionEmitter&&n.collisionEmitter.emitter.emit(n.collisionEmitter.uid+r,n,t,i)};
},{"events":51}],39:[function(require,module,exports){
"use strict";var ContactEmitter=require("./ContactEmitter"),Box2D=Module,listener=module.exports=new Box2D.JSContactListener,curContacts={};listener.BeginContact=function(t){var e=curContacts[t]={contact:Box2D.wrapPointer(t,Box2D.b2Contact)};e.isSensor=e.contact.GetFixtureA().IsSensor()||e.contact.GetFixtureB().IsSensor(),e.isSensor&&ContactEmitter.attemptContact(e,!0)},listener.PreSolve=function(){},listener.PostSolve=function(t,e){var n=curContacts[t],o=n.impulse;n.impulse=e,o||ContactEmitter.attemptContact(n,!0)},listener.EndContact=function(t){var e=curContacts[t];delete curContacts[t],delete e.impulse,ContactEmitter.attemptContact(e,!1)};
},{"./ContactEmitter":38}],40:[function(require,module,exports){
"use strict";var EE=require("events").EventEmitter,Vec2=Module.b2Vec2,KeyBoard=module.exports=function(t){EE.call(this),this.isOn={A:!1,S:!1,D:!1,W:!1,P:!1,L:!1,38:!1,40:!1},this.vec2=new Vec2,t.addEventListener("keydown",function(t){var e=t.keyCode,i=String.fromCharCode(t.keyCode);if(!(i in this.isOn)){if(!(e in this.isOn))return;if(this.isOn[e])return;switch(this.isOn[e]=!0,e){case 38:return void this.zoomIn();case 40:return void this.zoomOut()}}if(!this.isOn[i])switch(this.isOn[i]=!0,i){case"A":return void this.move(-1,0);case"S":return void this.move(0,-1);case"D":return void this.move(1,0);case"W":return void this.move(0,1);case"P":return void this.run(!0);case"L":return void this.attack(!0)}}.bind(this)),t.addEventListener("keyup",function(t){var e=String.fromCharCode(t.keyCode);if(e in this.isOn)switch(this.isOn[e]=!1,e){case"A":return void this.move(1,0);case"S":return void this.move(0,1);case"D":return void this.move(-1,0);case"W":return void this.move(0,-1);case"P":return void this.run(!1);case"L":return void this.attack(!1)}}.bind(this))};KeyBoard.prototype=Object.create(EE.prototype),KeyBoard.prototype.constructor=KeyBoard,KeyBoard.prototype.move=function(t,e){this.vec2.add(t,e),this.emit("change-direction",this.vec2)},KeyBoard.prototype.run=function(t){this.emit("run",t)},KeyBoard.prototype.zoomIn=function(){this.emit("zoom",1)},KeyBoard.prototype.zoomOut=function(){this.emit("zoom",-1)},KeyBoard.prototype.attack=function(t){return t?this.emit("attack",t):void 0},KeyBoard.findKeyBoard=function(){return[document.body]};
},{"events":51}],41:[function(require,module,exports){
"use strict";var Box2D=Module,DebugDraw=Box2D.JSDraw,Vec2=Box2D.b2Vec2,proto={},tempV=new Vec2,tempV2=new Vec2;module.exports=function(t,o,e){var r=new DebugDraw;for(var a in proto)r[a]=proto[a];return r.width=o,r.height=e,r.context=t,r},proto.flush=function(){this.context._canvas&&this.context._canvas.frame()},proto.setColorFromDebugDrawCallback=function(t){var o=this.context,e=Box2D.wrapPointer(t,Box2D.b2Color),r=255*e.get_r()|0,a=255*e.get_g()|0,i=255*e.get_b()|0,n=r+","+a+","+i;o.fillStyle="rgba("+n+",0.5)",o.strokeStyle="rgb("+n+")"},proto.DrawSegment=function(t,o,e){var r=this.context;this.setColorFromDebugDrawCallback(e);var a=Box2D.wrapPointer(t,Box2D.b2Vec2),i=Box2D.wrapPointer(o,Box2D.b2Vec2);r.beginPath(),r.moveTo(a.get_x(),a.get_y()),r.lineTo(i.get_x(),i.get_y()),r.stroke()},proto.DrawPolygon=function(t,o,e){this.setColorFromDebugDrawCallback(e),this.polygon(t,o,!1)},proto.DrawSolidPolygon=function(t,o,e){this.setColorFromDebugDrawCallback(e),this.polygon(t,o,!0)},proto.polygon=function(t,o,e){var r=this.context;r.beginPath();for(var a=0;o>a;a++){var i=Box2D.wrapPointer(t+8*a,Box2D.b2Vec2);0===a?r.moveTo(i.get_x(),i.get_y()):r.lineTo(i.get_x(),i.get_y())}r.closePath(),e&&r.fill(),r.stroke()},proto.DrawCircle=function(t,o,e){this.setColorFromDebugDrawCallback(e);var r=Box2D.b2Vec2(0,0);this.circle(t,o,r,!1)},proto.DrawText=function(t,o,e,r){this.setColorFromDebugDrawCallback(r);var a=this.context;a.scale(1,-1),a.textAlign="center",a.textBaseline="middle",a.font=e+"px Courier",a.fillText(t,o.get_x(),-o.get_y()),a.scale(1,-1)},proto.DrawSolidCircle=function(t,o,e,r){this.setColorFromDebugDrawCallback(r),this.circle(t,o,e,!0)},proto.circle=function(t,o,e,r){var a=this.context,i=Box2D.wrapPointer(t,Box2D.b2Vec2),n=Box2D.wrapPointer(e,Box2D.b2Vec2);a.beginPath(),a.arc(i.get_x(),i.get_y(),o,0,2*Math.PI,!1),r&&a.fill(),a.stroke(),r&&(tempV.set(i).op_add(tempV2.set(n).mul(o)),a.beginPath(),a.moveTo(i.get_x(),i.get_y()),a.lineTo(tempV.get_x(),tempV.get_y()),a.stroke())},proto.DrawTransform=function(t){var o=this.context,e=Box2D.wrapPointer(t,Box2D.b2Transform),r=e.get_p(),a=e.get_q();o.save(),o.translate(r.get_x(),r.get_y()),o.rotate(a.GetAngle()),o.lineWidth*=2,this.axis(),o.restore()},proto.axis=function(){var t=this.context;t.strokeStyle="rgb(192,0,0)",t.beginPath(),t.moveTo(0,0),t.lineTo(1,0),t.stroke(),t.strokeStyle="rgb(0,192,0)",t.beginPath(),t.moveTo(0,0),t.lineTo(0,1),t.stroke()},proto.clear=function(){var t=this.context;t.save(),t.setTransform(1,0,0,1,0,0),t.clearRect(0,0,this.width,this.height),t.restore()};
},{}],42:[function(require,module,exports){
"use strict";var preLinear,preAngular,preMovement,PI2=2*Math.PI;module.exports=function(e){e.pre("movement",preMovement.bind(e))},preMovement=function(e){var n=e.linear.Length();return{angular:preAngular.call(this,e.angular,n),linear:preLinear.call(this,e.linear)}},preLinear=function(e){return e.mul(this.isRunning?this.config.runSpeed:this.config.walkSpeed).sub(this.body.GetLinearVelocity())},preAngular=function(e,n){var r=this.body.GetAngle()%PI2,t=e-r,a=e-r+PI2;return Math.abs(a)<Math.abs(t)&&(t=e-r+PI2),a=e-r-PI2,Math.abs(a)<Math.abs(t)&&(t=e-r-PI2),n*t-this.body.GetAngularVelocity()};
},{}],43:[function(require,module,exports){
"use strict";var Vec2=Module.b2Vec2;Vec2.prototype.clone=function(){return new Vec2(this.get_x(),this.get_y())},Vec2.prototype.set=function(t,e){return void 0===e&&("object"==typeof t?(e=t.get_y(),t=t.get_x()):e=t),this.Set(t,e),this},Vec2.prototype.add=function(t,e){return void 0===e&&("object"==typeof t?(e=t.get_y(),t=t.get_x()):e=t),this.Set(this.get_x()+t,this.get_y()+e),this},Vec2.prototype.sub=function(t,e){return void 0===e&&("object"==typeof t?(e=t.get_y(),t=t.get_x()):e=t),this.Set(this.get_x()-t,this.get_y()-e),this},Vec2.prototype.mul=function(t,e){return void 0===e&&("object"==typeof t?(e=t.get_y(),t=t.get_x()):e=t),this.Set(this.get_x()*t,this.get_y()*e),this},Vec2.prototype.setAngle=function(t){return this.Set(Math.cos(t),Math.sin(t)),this},Vec2.prototype.equals=function(t){return this.get_x()!==t.get_x()?!1:this.get_y()!==t.get_y()?!1:!0},Vec2.prototype.toString=function(){return"{"+this.get_x()+", "+this.get_y()+"}"};
},{}],44:[function(require,module,exports){
require("./Vec2");
},{"./Vec2":43}],45:[function(require,module,exports){
"use strict";var Box2D=Module,b2Filter=Box2D.b2Filter,b2Body=Box2D.b2Body,b2Fixture=Box2D.b2Fixture,GROUP_COUNTER=1;module.exports.resetCollidable=function(e){if(e instanceof b2Fixture){if(!e.lastFilterValue&&!e.lastGroupValue)return;var t=e.GetFilterData();return void 0!==e.lastFilterValue&&t.set_maskBits(e.lastFilterValue),void 0!==e.lastGroupValue&&t.set_groupIndex(e.lastGroupValue),void e.SetFilterData(t)}if(e instanceof b2Body)for(var r=e.GetFixtureList();r.ptr;)this.resetCollidable(r),r=r.GetNext()},module.exports.makeUncollidable=function(e){if(e instanceof b2Fixture){var t=e.GetFilterData();return e.lastFilterValue=t.get_maskBits()||e.lastFilterValue,e.lastGroupValue=t.get_groupIndex()||e.lastGroupValue,t.set_maskBits(0),void t.set_groupIndex(0)}if(e instanceof b2Body)for(var r=e.GetFixtureList();r.ptr;)this.makeUncollidable(r),r=r.GetNext()},module.exports.newGroup=function(e,t){var r,o,i;for(o=0,i=e.length;i>o;o++)if(e[o].currentGroup){if(r&&r!==e[o].currentGroup)throw new Error("We have two bodies with different groups changing those groups may produce undesirable results");if(t&&e[o].currentGroup<1)throw new Error("When a body already has a collidable/uncollidable group, setting it to the opposite may produce undesireable results");r=e[o].currentGroup}for(r||(r=GROUP_COUNTER*(t?1:-1),GROUP_COUNTER*=2),o=0,i=e.length;i>o;o++)this.addToGroup(e[o],r)},module.exports.addToGroup=function(e,t){if(e instanceof b2Fixture){var r=e.GetFilterData();return r.set_groupIndex(t),void e.SetFilterData(r)}if(e instanceof b2Body){for(var o=e.GetFixtureList();o.ptr;)this.addToGroup(o,t),o=o.GetNext();e.currentGroup=t}},module.exports.removeFromGroup=function(e,t){if(e instanceof b2Fixture){var r=e.GetFilterData();return r.set_groupIndex(0),void e.SetFilterData(r)}if(e instanceof b2Body){for(var o=e.GetFixtureList();o.ptr;)this.removeFromGroup(o),o=o.GetNext();e.currentGroup=t}};
},{}],46:[function(require,module,exports){
"use strict";var B2d=Module,FixDef=B2d.b2FixtureDef,CircleShape=B2d.b2CircleShape,PolygonShape=B2d.b2PolygonShape,Vec2=B2d.b2Vec2,tVec=new Vec2;module.exports.circle=function(e,t){var r=new CircleShape;return r.set_m_radius(e),t&&r.set_m_p(t),this.createFixture(r)},module.exports.rect=function(){var e=new PolygonShape;return e.SetAsBox.apply(e,arguments),this.createFixture(e)},module.exports.polygon=function(){},module.exports.createFixture=function(e){var t=new FixDef;return t.set_shape(e),t.set_friction(.3),t},module.exports.fromConfig=function(e){var t;switch(e.position?tVec.set(e.position.x,e.position.y):tVec.set(0,0),e.type.toLowerCase()){case"circle":t=this.circle(e.radius||1,tVec);break;case"rectangle":t=this.rect(e.dimension.x||1,e.dimension.y||1,tVec,0)}return t.set_isSensor(!!e.sensor),t.set_density(e.density||1),t};
},{}],47:[function(require,module,exports){
"use strict";var FixtureHelper=require("../Helpers/box2d/Fixture"),PersonalBubble=module.exports=function(t,e){this.radius=e,this.player=t,this.activity=0,this.adrenaline=0,this.energy=0,this.startImpact=this.startImpact.bind(this),this.endImpact=this.endImpact.bind(this),t.on("body",this.spawn.bind(this)),t.game.on("time",this.onTime.bind(this)),t.on("weapon-attack",function(){this.energy-=t.weapon.expense}.bind(this)),t.post("damage",function(t){this.adrenaline+=this.energy-Math.pow(t.value-this.energy,2)}.bind(this)),t.pre("movement",function(t){return t.linear.mul(Math.max(1,this.adrenaline)),t}.bind(this))};PersonalBubble.prototype.onTime=function(){this.adrenaline--,this.adrenaline+=this.activity,this.energy+=this.isRunning?-4:1},PersonalBubble.prototype.spawn=function(t){var e=FixtureHelper.circle(this.radius);e.set_isSensor(!0),e.personalBubble=this,this.fixture=t.CreateFixture(e),this.player.onContactStart(this.fixture,this.startImpact.bind(this)),this.player.onContactStart(this.fixture,this.endImpact.bind(this))},PersonalBubble.prototype.startImpact=function(t,e,i){return i.damager?void(this.player.adrenaline+=2):(i.personalBubble&&this.activity++,void(i.damageable&&i.damageable.controller&&this.activity++))},PersonalBubble.prototype.endImpact=function(t,e,i){i.damager||(i.personalBubble&&this.activity--,i.damageable&&i.damageable.controller&&this.activity--)};
},{"../Helpers/box2d/Fixture":46}],48:[function(require,module,exports){
"use strict";var PersonalBubble=require("./PersonalBubble"),Attacker=require("../Dungeon/Combat/Attacker"),Damageable=require("../Dungeon/Combat/Damageable"),Movable=require("../Dungeon/Entity/Moveable"),FixtureHelper=require("../Helpers/box2d/Fixture"),DirectMovement=require("../General/Movement/direct-control"),Player=module.exports=function(e,t,r){this.element=r.element,this.config=r,this.isPlayer=!0,this.controller=t,Movable.call(this,e,t),Attacker.call(this,e,t),Damageable.call(this,e,r.hp),t.on("run",function(e){this.isRunning=e}.bind(this)),DirectMovement(this),this.personalBubble=new PersonalBubble(this,r.personalBubbleRadius),this.on("equippable",this.equip.bind(this))};Player.prototype=Object.create(Movable.prototype);for(var name in Damageable.prototype)Player.prototype[name]=Damageable.prototype[name];for(name in Attacker.prototype)Player.prototype[name]=Attacker.prototype[name];Player.prototype.constructor=Player,Player.prototype.getDamageableShape=function(){return FixtureHelper.circle(this.config.damageableRadius)},Player.prototype.equip=function(e){if(e.isWeapon)return this.useWeapon(e);if(e.isArmor)return this.useArmor(e);throw new Error("Cannot equip non weapon, non Armor")};
},{"../Dungeon/Combat/Attacker":16,"../Dungeon/Combat/Damageable":17,"../Dungeon/Entity/Moveable":26,"../General/Movement/direct-control":42,"../Helpers/box2d/Fixture":46,"./PersonalBubble":47}],49:[function(require,module,exports){
"use strict";require("./Helpers/Override"),require("setimmediate");var EE=require("events").EventEmitter,Random=require("mersenne-twister"),Tower=require("./Dungeon/Tower"),Player=require("./Player"),Camera=require("./General/Camera"),contactListener=require("./General/Collision/ContactListener"),assets=require("./Assets");console.log(assets);var B2d=Module,Vec2=B2d.b2Vec2,World=B2d.b2World,Game=module.exports=function(e,t,r,i){EE.call(this),this.timeListeners=[],this.nextTime=this.nextTime.bind(this),this.on("newListener",function(e){console.trace(e)});var s=new Random(e);this.rng=s.random.bind(s),this.world=new World(new Vec2),this.world.SetContactListener(contactListener),this.draw=t,this.camera=new Camera(t.context,{max:10,cur:i,min:.5},.1,r),this.world.SetDebugDraw(t),this.tower=new Tower(this,8,assets.Rooms),this.player=new Player(this,r,{hp:30,damageableRadius:3,personalBubbleRadius:10,runSpeed:20,walkSpeed:10})};Game.prototype=Object.create(EE.prototype),Game.prototype.constructor=Game,Game.prototype.loop=function(){for(var e=1/60,t=this.timeListeners.length;t--;)this.once("time",this.timeListeners.pop());this.emit("time",e);var r=10;this.world.Step(e,r),this.render(e),setImmediate(this.loop.bind(this))},Game.prototype.render=function(e){this.draw.clear(),this.camera.step(e),this.emit("pre-debugDraw",this.draw),this.world.DrawDebugData(),this.emit("post-debugDraw",this.draw),this.draw.flush()},Game.prototype.start=function(){console.log("starting"),this.tower.setFloor(0),this.player.spawn(this.world,this.tower.getStart()),this.camera.follow(this.player.body),console.log("spawned"),setImmediate(this.loop.bind(this))},Game.prototype.nextTime=function(e){this.timeListeners.push(e)};
},{"./Assets":10,"./Dungeon/Tower":36,"./General/Camera":37,"./General/Collision/ContactListener":39,"./Helpers/Override":44,"./Player":48,"events":51,"mersenne-twister":53,"setimmediate":55}],50:[function(require,module,exports){
"use strict";var Game=require("./game"),Draw=require("./General/Draw"),Keyboard,keyboard,readyListener;readyListener=window.addEventListener.bind(window,"load"),Keyboard=require("./General/Controller/keyboard"),keyboard=new Keyboard(window);var e_shapeBit=1,e_jointBit=2,e_centerOfMassBit=16;readyListener(function(){var e,r,t,a=document.getElementsByTagName("canvas")[0];e=a.getContext("2d"),t=parseInt(window.getComputedStyle(a).width.substring(-2)),r=parseInt(window.getComputedStyle(a).height.substring(-2));var n=Draw(e,t,r),i=0;i|=e_shapeBit,i|=e_jointBit,i|=e_centerOfMassBit,n.SetFlags(i);var d=new Game(1234,n,keyboard,{x:t,y:r});d.start()});
},{"./General/Controller/keyboard":40,"./General/Draw":41,"./game":49}],51:[function(require,module,exports){
function EventEmitter(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function isFunction(e){return"function"==typeof e}function isNumber(e){return"number"==typeof e}function isObject(e){return"object"==typeof e&&null!==e}function isUndefined(e){return void 0===e}module.exports=EventEmitter,EventEmitter.EventEmitter=EventEmitter,EventEmitter.prototype._events=void 0,EventEmitter.prototype._maxListeners=void 0,EventEmitter.defaultMaxListeners=10,EventEmitter.prototype.setMaxListeners=function(e){if(!isNumber(e)||0>e||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},EventEmitter.prototype.emit=function(e){var t,n,s,i,r,o;if(this._events||(this._events={}),"error"===e&&(!this._events.error||isObject(this._events.error)&&!this._events.error.length)){if(t=arguments[1],t instanceof Error)throw t;throw TypeError('Uncaught, unspecified "error" event.')}if(n=this._events[e],isUndefined(n))return!1;if(isFunction(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:for(s=arguments.length,i=new Array(s-1),r=1;s>r;r++)i[r-1]=arguments[r];n.apply(this,i)}else if(isObject(n)){for(s=arguments.length,i=new Array(s-1),r=1;s>r;r++)i[r-1]=arguments[r];for(o=n.slice(),s=o.length,r=0;s>r;r++)o[r].apply(this,i)}return!0},EventEmitter.prototype.addListener=function(e,t){var n;if(!isFunction(t))throw TypeError("listener must be a function");if(this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,isFunction(t.listener)?t.listener:t),this._events[e]?isObject(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,isObject(this._events[e])&&!this._events[e].warned){var n;n=isUndefined(this._maxListeners)?EventEmitter.defaultMaxListeners:this._maxListeners,n&&n>0&&this._events[e].length>n&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace())}return this},EventEmitter.prototype.on=EventEmitter.prototype.addListener,EventEmitter.prototype.once=function(e,t){function n(){this.removeListener(e,n),s||(s=!0,t.apply(this,arguments))}if(!isFunction(t))throw TypeError("listener must be a function");var s=!1;return n.listener=t,this.on(e,n),this},EventEmitter.prototype.removeListener=function(e,t){var n,s,i,r;if(!isFunction(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(n=this._events[e],i=n.length,s=-1,n===t||isFunction(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(isObject(n)){for(r=i;r-- >0;)if(n[r]===t||n[r].listener&&n[r].listener===t){s=r;break}if(0>s)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(s,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},EventEmitter.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[e],isFunction(n))this.removeListener(e,n);else for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},EventEmitter.prototype.listeners=function(e){var t;return t=this._events&&this._events[e]?isFunction(this._events[e])?[this._events[e]]:this._events[e].slice():[]},EventEmitter.listenerCount=function(e,t){var n;return n=e._events&&e._events[t]?isFunction(e._events[t])?1:e._events[t].length:0};
},{}],52:[function(require,module,exports){
var hat=module.exports=function(t,r){if(r||(r=16),void 0===t&&(t=128),0>=t)return"0";for(var o=Math.log(Math.pow(2,t))/Math.log(r),a=2;o===1/0;a*=2)o=Math.log(Math.pow(2,t/a))/Math.log(r)*a;for(var n=o-Math.floor(o),h="",a=0;a<Math.floor(o);a++){var e=Math.floor(Math.random()*r).toString(r);h=e+h}if(n){var i=Math.pow(r,n),e=Math.floor(Math.random()*i).toString(r);h=e+h}var f=parseInt(h,r);return f!==1/0&&f>=Math.pow(2,t)?hat(t,r):h};hat.rack=function(t,r,o){var a=function(a){var h=0;do{if(h++>10){if(!o)throw new Error("too many ID collisions, use more bits");t+=o}var e=hat(t,r)}while(Object.hasOwnProperty.call(n,e));return n[e]=a,e},n=a.hats={};return a.get=function(t){return a.hats[t]},a.set=function(t,r){return a.hats[t]=r,a},a.bits=t||128,a.base=r||16,a};
},{}],53:[function(require,module,exports){
var MersenneTwister=function(t){void 0==t&&(t=(new Date).getTime()),this.N=624,this.M=397,this.MATRIX_A=2567483615,this.UPPER_MASK=2147483648,this.LOWER_MASK=2147483647,this.mt=new Array(this.N),this.mti=this.N+1,this.init_seed(t)};MersenneTwister.prototype.init_seed=function(t){for(this.mt[0]=t>>>0,this.mti=1;this.mti<this.N;this.mti++){var t=this.mt[this.mti-1]^this.mt[this.mti-1]>>>30;this.mt[this.mti]=(1812433253*((4294901760&t)>>>16)<<16)+1812433253*(65535&t)+this.mti,this.mt[this.mti]>>>=0}},MersenneTwister.prototype.init_by_array=function(t,i){var s,h,n;for(this.init_seed(19650218),s=1,h=0,n=this.N>i?this.N:i;n;n--){var r=this.mt[s-1]^this.mt[s-1]>>>30;this.mt[s]=(this.mt[s]^(1664525*((4294901760&r)>>>16)<<16)+1664525*(65535&r))+t[h]+h,this.mt[s]>>>=0,s++,h++,s>=this.N&&(this.mt[0]=this.mt[this.N-1],s=1),h>=i&&(h=0)}for(n=this.N-1;n;n--){var r=this.mt[s-1]^this.mt[s-1]>>>30;this.mt[s]=(this.mt[s]^(1566083941*((4294901760&r)>>>16)<<16)+1566083941*(65535&r))-s,this.mt[s]>>>=0,s++,s>=this.N&&(this.mt[0]=this.mt[this.N-1],s=1)}this.mt[0]=2147483648},MersenneTwister.prototype.random_int=function(){var t,i=new Array(0,this.MATRIX_A);if(this.mti>=this.N){var s;for(this.mti==this.N+1&&this.init_seed(5489),s=0;s<this.N-this.M;s++)t=this.mt[s]&this.UPPER_MASK|this.mt[s+1]&this.LOWER_MASK,this.mt[s]=this.mt[s+this.M]^t>>>1^i[1&t];for(;s<this.N-1;s++)t=this.mt[s]&this.UPPER_MASK|this.mt[s+1]&this.LOWER_MASK,this.mt[s]=this.mt[s+(this.M-this.N)]^t>>>1^i[1&t];t=this.mt[this.N-1]&this.UPPER_MASK|this.mt[0]&this.LOWER_MASK,this.mt[this.N-1]=this.mt[this.M-1]^t>>>1^i[1&t],this.mti=0}return t=this.mt[this.mti++],t^=t>>>11,t^=t<<7&2636928640,t^=t<<15&4022730752,t^=t>>>18,t>>>0},MersenneTwister.prototype.random_int31=function(){return this.random_int()>>>1},MersenneTwister.prototype.random_incl=function(){return this.random_int()*(1/4294967295)},MersenneTwister.prototype.random=function(){return this.random_int()*(1/4294967296)},MersenneTwister.prototype.random_excl=function(){return(this.random_int()+.5)*(1/4294967296)},MersenneTwister.prototype.random_long=function(){var t=this.random_int()>>>5,i=this.random_int()>>>6;return(67108864*t+i)*(1/9007199254740992)},module.exports=MersenneTwister;
},{}],54:[function(require,module,exports){
function cleanUpNextTick(){draining=!1,currentQueue.length?queue=currentQueue.concat(queue):queueIndex=-1,queue.length&&drainQueue()}function drainQueue(){if(!draining){var e=setTimeout(cleanUpNextTick);draining=!0;for(var n=queue.length;n;){for(currentQueue=queue,queue=[];++queueIndex<n;)currentQueue&&currentQueue[queueIndex].run();queueIndex=-1,n=queue.length}currentQueue=null,draining=!1,clearTimeout(e)}}function Item(e,n){this.fun=e,this.array=n}function noop(){}var process=module.exports={},queue=[],draining=!1,currentQueue,queueIndex=-1;process.nextTick=function(e){var n=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)n[r-1]=arguments[r];queue.push(new Item(e,n)),1!==queue.length||draining||setTimeout(drainQueue,0)},Item.prototype.run=function(){this.fun.apply(null,this.array)},process.title="browser",process.browser=!0,process.env={},process.argv=[],process.version="",process.versions={},process.on=noop,process.addListener=noop,process.once=noop,process.off=noop,process.removeListener=noop,process.removeAllListeners=noop,process.emit=noop,process.binding=function(e){throw new Error("process.binding is not supported")},process.cwd=function(){return"/"},process.chdir=function(e){throw new Error("process.chdir is not supported")},process.umask=function(){return 0};
},{}],55:[function(require,module,exports){
(function (process,global){
!function(e,t){"use strict";function n(e){return d[g]=a.apply(t,e),g++}function a(e){var n=[].slice.call(arguments,1);return function(){"function"==typeof e?e.apply(t,n):new Function(""+e)()}}function s(e){if(p)setTimeout(a(s,e),0);else{var t=d[e];if(t){p=!0;try{t()}finally{o(e),p=!1}}}}function o(e){delete d[e]}function r(){m=function(){var e=n(arguments);return process.nextTick(a(s,e)),e}}function i(){if(e.postMessage&&!e.importScripts){var t=!0,n=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=n,t}}function c(){var t="setImmediate$"+Math.random()+"$",a=function(n){n.source===e&&"string"==typeof n.data&&0===n.data.indexOf(t)&&s(+n.data.slice(t.length))};e.addEventListener?e.addEventListener("message",a,!1):e.attachEvent("onmessage",a),m=function(){var a=n(arguments);return e.postMessage(t+a,"*"),a}}function u(){var e=new MessageChannel;e.port1.onmessage=function(e){var t=e.data;s(t)},m=function(){var t=n(arguments);return e.port2.postMessage(t),t}}function f(){var e=v.documentElement;m=function(){var t=n(arguments),a=v.createElement("script");return a.onreadystatechange=function(){s(t),a.onreadystatechange=null,e.removeChild(a),a=null},e.appendChild(a),t}}function l(){m=function(){var e=n(arguments);return setTimeout(a(s,e),0),e}}if(!e.setImmediate){var m,g=1,d={},p=!1,v=e.document,y=Object.getPrototypeOf&&Object.getPrototypeOf(e);y=y&&y.setTimeout?y:e,"[object process]"==={}.toString.call(e.process)?r():i()?c():e.MessageChannel?u():v&&"onreadystatechange"in v.createElement("script")?f():l(),y.setImmediate=m,y.clearImmediate=o}}("undefined"==typeof self?"undefined"==typeof global?this:global:self);
}).call(this,require('_process'),typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"_process":54}]},{},[50]);
